<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text-html; charset=utf-8" /><title>3&nbsp;Queries</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default" /><link rel="stylesheet" type="text/css" href="../racket.css" title="default" /><link rel="stylesheet" type="text/css" href="../scribble-style.css" title="default" /><script type="text/javascript" src="../scribble-common.js"></script></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist" style="margin-bottom: 1em;"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" pltdoc="x">DB:<span class="mywbr"> </span> Database Connectivity</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="introduction.html" class="tocviewlink" pltdoc="x">Introduction</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="connect.html" class="tocviewlink" pltdoc="x">Connections</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="" class="tocviewselflink" pltdoc="x">Queries</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="sql-types.html" class="tocviewlink" pltdoc="x">SQL Types and Conversions</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="util.html" class="tocviewlink" pltdoc="x">Utilities</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="notes.html" class="tocviewlink" pltdoc="x">Notes</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>3&nbsp;</td><td><a href="" class="tocviewselflink" pltdoc="x">Queries</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">3.1&nbsp;</td><td><a href="#(part._.Statements)" class="tocviewlink" pltdoc="x">Statements</a></td></tr><tr><td align="right">3.2&nbsp;</td><td><a href="#(part._.Simple_.Queries)" class="tocviewlink" pltdoc="x">Simple Queries</a></td></tr><tr><td align="right">3.3&nbsp;</td><td><a href="#(part._.General_.Query_.Support)" class="tocviewlink" pltdoc="x">General Query Support</a></td></tr><tr><td align="right">3.4&nbsp;</td><td><a href="#(part._.Prepared_.Statements)" class="tocviewlink" pltdoc="x">Prepared Statements</a></td></tr><tr><td align="right">3.5&nbsp;</td><td><a href="#(part._transactions)" class="tocviewlink" pltdoc="x">Transactions</a></td></tr><tr><td align="right">3.6&nbsp;</td><td><a href="#(part._.S.Q.L_.Errors)" class="tocviewlink" pltdoc="x">SQL Errors</a></td></tr><tr><td align="right">3.7&nbsp;</td><td><a href="#(part._.Database_.Catalog_.Information)" class="tocviewlink" pltdoc="x">Database Catalog Information</a></td></tr><tr><td align="right">3.8&nbsp;</td><td><a href="#(part._.Creating_.New_.Kinds_of_.Statements)" class="tocviewlink" pltdoc="x">Creating New Kinds of Statements</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">3.1<tt>&nbsp;</tt></span><a href="#(part._.Statements)" class="tocsubseclink" pltdoc="x">Statements</a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._statement~3f))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">statement?</span></span></span></a></td></tr><tr><td><span class="tocsublinknumber">3.2<tt>&nbsp;</tt></span><a href="#(part._.Simple_.Queries)" class="tocsubseclink" pltdoc="x">Simple Queries</a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._query-exec))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">query-<wbr></wbr>exec</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._query-rows))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">query-<wbr></wbr>rows</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._query-list))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">query-<wbr></wbr>list</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._query-row))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">query-<wbr></wbr>row</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._query-maybe-row))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">query-<wbr></wbr>maybe-<wbr></wbr>row</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._query-value))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">query-<wbr></wbr>value</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._query-maybe-value))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">query-<wbr></wbr>maybe-<wbr></wbr>value</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._in-query))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">in-<wbr></wbr>query</span></span></span></a></td></tr><tr><td><span class="tocsublinknumber">3.3<tt>&nbsp;</tt></span><a href="#(part._.General_.Query_.Support)" class="tocsubseclink" pltdoc="x">General Query Support</a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._simple-result))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">simple-<wbr></wbr>result</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._rows-result))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">rows-<wbr></wbr>result</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._query))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">query</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._group-rows))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">group-<wbr></wbr>rows</span></span></span></a></td></tr><tr><td><span class="tocsublinknumber">3.4<tt>&nbsp;</tt></span><a href="#(part._.Prepared_.Statements)" class="tocsubseclink" pltdoc="x">Prepared Statements</a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._prepare))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">prepare</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._prepared-statement~3f))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">prepared-<wbr></wbr>statement?</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._prepared-statement-parameter-types))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">prepared-<wbr></wbr>statement-<wbr></wbr>parameter-<wbr></wbr>types</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._prepared-statement-result-types))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">prepared-<wbr></wbr>statement-<wbr></wbr>result-<wbr></wbr>types</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._bind-prepared-statement))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">bind-<wbr></wbr>prepared-<wbr></wbr>statement</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._statement-binding~3f))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">statement-<wbr></wbr>binding?</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._virtual-statement))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">virtual-<wbr></wbr>statement</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._virtual-statement~3f))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">virtual-<wbr></wbr>statement?</span></span></span></a></td></tr><tr><td><span class="tocsublinknumber">3.5<tt>&nbsp;</tt></span><a href="#(part._transactions)" class="tocsubseclink" pltdoc="x">Transactions</a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._start-transaction))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">start-<wbr></wbr>transaction</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._commit-transaction))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">commit-<wbr></wbr>transaction</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._rollback-transaction))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">rollback-<wbr></wbr>transaction</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._in-transaction~3f))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">in-<wbr></wbr>transaction?</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._needs-rollback~3f))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">needs-<wbr></wbr>rollback?</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._call-with-transaction))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">call-<wbr></wbr>with-<wbr></wbr>transaction</span></span></span></a></td></tr><tr><td><span class="tocsublinknumber">3.6<tt>&nbsp;</tt></span><a href="#(part._.S.Q.L_.Errors)" class="tocsubseclink" pltdoc="x">SQL Errors</a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._exn~3afail~3asql))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">exn:<span class="mywbr"> </span>fail:<span class="mywbr"> </span>sql</span></span></span></a></td></tr><tr><td><span class="tocsublinknumber">3.7<tt>&nbsp;</tt></span><a href="#(part._.Database_.Catalog_.Information)" class="tocsubseclink" pltdoc="x">Database Catalog Information</a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._list-tables))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">list-<wbr></wbr>tables</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._table-exists~3f))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">table-<wbr></wbr>exists?</span></span></span></a></td></tr><tr><td><span class="tocsublinknumber">3.8<tt>&nbsp;</tt></span><a href="#(part._.Creating_.New_.Kinds_of_.Statements)" class="tocsubseclink" pltdoc="x">Creating New Kinds of Statements</a></td></tr><tr><td><a href="#(def._((lib._db/main..rkt)._prop~3astatement))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: db, db/base"><span class="RktSym"><span class="RktValLink">prop:<span class="mywbr"> </span>statement</span></span></span></a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.2.1&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.2.1&quot;);">top</a></span><span class="navright"><a href="connect.html" title="backward to &quot;2 Connections&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;DB: Database Connectivity&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<a href="sql-types.html" title="forward to &quot;4 SQL Types and Conversions&quot;" pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3>3<tt>&nbsp;</tt><a name="(part._query-api)"></a>Queries</h3><p>This library provides a high-level functional query API,
unlike many other database libraries, which present a stateful,
iteration-based interface to queries. When a query function is
invoked, it either returns a result or, if the query caused an error,
raises an exception. Different query functions impose different
constraints on the query results and offer different mechanisms for
processing the results.</p><p><div class="SIntrapara"><span style="font-weight: bold">Errors</span> In most cases, a query error does not cause the
connection to be disconnected. Specifically, the following kinds of
errors should never cause a connection to be disconnected:
</div><div class="SIntrapara"><ul><li><p>SQL syntax errors, such as references to undefined tables,
columns, or operations, etc</p></li><li><p>SQL runtime errors, such as integrity constraint violations</p></li><li><p>violations of a specialized query function&rsquo;s expectations, such
as using <span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-value))" class="RktValLink" pltdoc="x">query-value</a></span> with a query that returns multiple
columns</p></li><li><p>supplying the wrong number or wrong types of parameters to a
prepared query, executing a prepared query with the wrong
connection, etc</p></li></ul></div><div class="SIntrapara">The following kinds of errors may cause a connection to be
disconnected:
</div><div class="SIntrapara"><ul><li><p>changing communication settings, such as changing the
connection&rsquo;s character encoding</p></li><li><p>communication failures and internal errors in the library</p></li></ul></div><div class="SIntrapara">See <a href="#(part._transactions)" pltdoc="x">Transactions</a> for information on how errors can affect
the transaction status.</div></p><p><span style="font-weight: bold">Character encoding</span> This library is designed to interact with
database systems using the UTF-8 character encoding. The connection
functions attempt to negotiate UTF-8 communication at the beginning of
every connection, but some systems also allow the character encoding
to be changed via SQL commands (eg, <span class="stt">SET NAMES</span>). If this happens,
the client might be unable to reliably communicate with the database,
and data might get corrupted in transmission. Avoid changing a
connection&rsquo;s character encoding. When possible, the connection will
observe the change and automatically disconnect with an error.</p><p><span style="font-weight: bold">Synchronization</span> Connections are internally synchronized: it is
safe to perform concurrent queries on the same connection object from
different threads. Connections are not kill-safe: killing a thread
that is using a connection&#8212;<wbr></wbr>or shutting down the connection&rsquo;s
managing custodian&#8212;<wbr></wbr>may leave the connection locked, causing future
operations to block indefinitely. See <a href="connect.html#(part._kill-safe)" pltdoc="x">Kill-safe Connections</a> for a
way to make kill-safe connections.</p><h4>3.1<tt>&nbsp;</tt><a name="(part._.Statements)"></a>Statements</h4><p><div class="SIntrapara">All query functions require both a connection and a
<a name="(tech._statement)"></a><span style="font-style: italic">statement</span>, which is one of the following:
</div><div class="SIntrapara"><ul><li><p>a string containing a single SQL statement</p></li><li><p>a <a href="#(tech._prepared._statement)" class="techoutside" pltdoc="x"><span class="techinside">prepared statement</span></a> produced by <span class="RktSym"><a href="#(def._((lib._db/main..rkt)._prepare))" class="RktValLink" pltdoc="x">prepare</a></span></p></li><li><p>a <a href="#(tech._virtual._statement)" class="techoutside" pltdoc="x"><span class="techinside">virtual statement</span></a> produced by
<span class="RktSym"><a href="#(def._((lib._db/main..rkt)._virtual-statement))" class="RktValLink" pltdoc="x">virtual-statement</a></span></p></li><li><p>a statement-binding value produced by
<span class="RktSym"><a href="#(def._((lib._db/main..rkt)._bind-prepared-statement))" class="RktValLink" pltdoc="x">bind-prepared-statement</a></span></p></li><li><p>an instance of a struct type that implements <span class="RktSym"><a href="#(def._((lib._db/main..rkt)._prop~3astatement))" class="RktValLink" pltdoc="x">prop:statement</a></span></p></li></ul></div></p><p>A SQL statement may contain parameter placeholders that stand for SQL
scalar values. The parameter values must be supplied when the
statement is executed; the parameterized statement and parameter
values are sent to the database back end, which combines them
correctly and safely.</p><p>Use parameters instead of Racket string interpolation (eg,
<span class="RktSym"><a href="../reference/Writing.html#(def._((quote._~23~25kernel)._format))" class="RktValLink" pltdoc="x">format</a></span> or <span class="RktSym"><a href="../reference/strings.html#(def._((quote._~23~25kernel)._string-append))" class="RktValLink" pltdoc="x">string-append</a></span>) to avoid
<a href="http://xkcd.com/327/">SQL injection</a>, where a string
intended to represent a SQL scalar value is interpreted as&#8212;<wbr></wbr>possibly
malicious&#8212;<wbr></wbr>SQL code instead.</p><p>The syntax of placeholders varies depending on the database
system. For example:</p><blockquote class="SCentered"><table cellspacing="0"><tr><td><p>PostgreSQL:   </p></td><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td><td><p>  <span class="stt">select * from the_numbers where n &gt; $1;</span> </p></td></tr><tr><td><p>
MySQL, ODBC:  </p></td><td><p></p></td><td><p>  <span class="stt">select * from the_numbers where n &gt; ?;</span> </p></td></tr><tr><td><p>
SQLite:       </p></td><td><p></p></td><td><p>  supports both syntaxes (plus others)</p></td></tr></table></blockquote><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._statement~3f))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._statement~3f))" class="RktValLink" pltdoc="x">statement?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="RktValLink" pltdoc="x">boolean?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">x</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns <span class="RktVal">#t</span> if <span class="RktVar">x</span> is a <a href="#(tech._statement)" class="techoutside" pltdoc="x"><span class="techinside">statement</span></a>, <span class="RktVal">#f</span>
otherwise.</div></p><h4>3.2<tt>&nbsp;</tt><a name="(part._.Simple_.Queries)"></a>Simple Queries</h4><p>The simple query API consists of a set of functions specialized to
various types of queries. For example, <span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-value))" class="RktValLink" pltdoc="x">query-value</a></span> is
specialized to queries that return exactly one row of exactly one
column.</p><p>If a statement takes parameters, the parameter values are given as
additional arguments immediately after the SQL statement. Only a
statement given as a string, <a href="#(tech._prepared._statement)" class="techoutside" pltdoc="x"><span class="techinside">prepared statement</span></a>, or
<a href="#(tech._virtual._statement)" class="techoutside" pltdoc="x"><span class="techinside">virtual statement</span></a> can be given &ldquo;inline&rdquo; parameters; if the
statement is a statement-binding, no inline parameters are permitted.</p><p>The types of parameters and returned fields are described in
<a href="sql-types.html" pltdoc="x">SQL Types and Conversions</a>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._query-exec))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-exec))" class="RktValLink" pltdoc="x">query-exec</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">connection</span><span class="hspace">&nbsp;</span><span class="RktVar">stmt</span><span class="hspace">&nbsp;</span><span class="RktVar">arg</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#(def._((quote._~23~25kernel)._void~3f))" class="RktValLink" pltdoc="x">void?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">connection</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="connect.html#(def._((lib._db/main..rkt)._connection~3f))" class="RktValLink" pltdoc="x">connection?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">stmt</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._statement~3f))" class="RktValLink" pltdoc="x">statement?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">arg</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Executes a SQL statement for effect.</div></p><p><table cellspacing="0" class="RktBlk"><tr><td><p>Examples:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-exec))" class="RktValLink" pltdoc="x">query-exec</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktVal">"insert into some_table values (1, 'a')"</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0"><tr><td></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-exec))" class="RktValLink" pltdoc="x">query-exec</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pgc</span><span class="hspace">&nbsp;</span><span class="RktVal">"delete from some_table where n = $1"</span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0"><tr><td></td></tr></table></td></tr></table></blockquote></td></tr></table></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><table cellspacing="0" class="prototype"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._query-rows))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-rows))" class="RktValLink" pltdoc="x">query-rows</a></span></span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">connection</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">stmt</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">arg</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span>[</td><td><span class="RktPn">#:group</span><span class="hspace">&nbsp;</span><span class="RktVar">grouping-fields</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">#:group-mode</span><span class="hspace">&nbsp;</span><span class="RktVar">group-mode</span>]<span class="RktPn">)</span></td><td><span class="hspace">&nbsp;</span></td><td>&rarr;</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._listof))" class="RktValLink" pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/vectors.html#(def._((quote._~23~25kernel)._vector~3f))" class="RktValLink" pltdoc="x">vector?</a></span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">connection</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="connect.html#(def._((lib._db/main..rkt)._connection~3f))" class="RktValLink" pltdoc="x">connection?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">stmt</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._statement~3f))" class="RktValLink" pltdoc="x">statement?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">arg</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span></td></tr><tr><td><table cellspacing="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">grouping-fields</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._or/c))" class="RktValLink" pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/vector..rkt)._vectorof))" class="RktValLink" pltdoc="x">vectorof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="RktValLink" pltdoc="x">string?</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._listof))" class="RktValLink" pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/vector..rkt)._vectorof))" class="RktValLink" pltdoc="x">vectorof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="RktValLink" pltdoc="x">string?</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td>=</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="../reference/pairs.html#(def._((quote._~23~25kernel)._null))" class="RktValLink" pltdoc="x">null</a></span></td></tr></table></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">group-mode</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._listof))" class="RktValLink" pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._or/c))" class="RktValLink" pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">preserve-null-rows</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">list</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/pairs.html#(def._((quote._~23~25kernel)._null))" class="RktValLink" pltdoc="x">null</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Executes a SQL query, which must produce rows, and returns the list
  of rows (as vectors) from the query.</div></p><p><table cellspacing="0" class="RktBlk"><tr><td><p>Examples:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-rows))" class="RktValLink" pltdoc="x">query-rows</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pgc</span><span class="hspace">&nbsp;</span><span class="RktVal">"select * from the_numbers where n = $1"</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(#(2 "company"))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-rows))" class="RktValLink" pltdoc="x">query-rows</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktVal">"select 17"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(#(17))</span></p></td></tr></table></blockquote></td></tr></table></p><p>If <span class="RktVar">grouping-fields</span> is not empty, the result is the same as if
  <span class="RktSym"><a href="#(def._((lib._db/main..rkt)._group-rows))" class="RktValLink" pltdoc="x">group-rows</a></span> had been called on the result rows.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._query-list))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-list))" class="RktValLink" pltdoc="x">query-list</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">connection</span><span class="hspace">&nbsp;</span><span class="RktVar">stmt</span><span class="hspace">&nbsp;</span><span class="RktVar">arg</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/pairs.html#(def._((quote._~23~25kernel)._list~3f))" class="RktValLink" pltdoc="x">list?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">connection</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="connect.html#(def._((lib._db/main..rkt)._connection~3f))" class="RktValLink" pltdoc="x">connection?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">stmt</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._statement~3f))" class="RktValLink" pltdoc="x">statement?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">arg</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Executes a SQL query, which must produce rows of exactly one
  column, and returns the list of values from the query.</div></p><p><table cellspacing="0" class="RktBlk"><tr><td><p>Examples:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-list))" class="RktValLink" pltdoc="x">query-list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktVal">"select n from the_numbers where n &lt; 2"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(0 1)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-list))" class="RktValLink" pltdoc="x">query-list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktVal">"select 'hello'"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'("hello")</span></p></td></tr></table></blockquote></td></tr></table></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._query-row))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-row))" class="RktValLink" pltdoc="x">query-row</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">connection</span><span class="hspace">&nbsp;</span><span class="RktVar">stmt</span><span class="hspace">&nbsp;</span><span class="RktVar">arg</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/vectors.html#(def._((quote._~23~25kernel)._vector~3f))" class="RktValLink" pltdoc="x">vector?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">connection</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="connect.html#(def._((lib._db/main..rkt)._connection~3f))" class="RktValLink" pltdoc="x">connection?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">stmt</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._statement~3f))" class="RktValLink" pltdoc="x">statement?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">arg</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Executes a SQL query, which must produce exactly one row, and
  returns its (single) row result as a vector.</div></p><p><table cellspacing="0" class="RktBlk"><tr><td><p>Examples:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-row))" class="RktValLink" pltdoc="x">query-row</a></span><span class="hspace">&nbsp;</span><span class="RktSym">myc</span><span class="hspace">&nbsp;</span><span class="RktVal">"select * from the_numbers where n = ?"</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'#(2 "company")</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-row))" class="RktValLink" pltdoc="x">query-row</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktVal">"select 17"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'#(17)</span></p></td></tr></table></blockquote></td></tr></table></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._query-maybe-row))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-maybe-row))" class="RktValLink" pltdoc="x">query-maybe-row</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">connection</span><span class="hspace">&nbsp;</span><span class="RktVar">stmt</span><span class="hspace">&nbsp;</span><span class="RktVar">arg</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._or/c))" class="RktValLink" pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/vectors.html#(def._((quote._~23~25kernel)._vector~3f))" class="RktValLink" pltdoc="x">vector?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">connection</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="connect.html#(def._((lib._db/main..rkt)._connection~3f))" class="RktValLink" pltdoc="x">connection?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">stmt</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._statement~3f))" class="RktValLink" pltdoc="x">statement?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">arg</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Like <span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-row))" class="RktValLink" pltdoc="x">query-row</a></span>, but the query may produce zero rows; in
  that case, <span class="RktVal">#f</span> is returned.</div></p><p><table cellspacing="0" class="RktBlk"><tr><td><p>Examples:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-maybe-row))" class="RktValLink" pltdoc="x">query-maybe-row</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pgc</span><span class="hspace">&nbsp;</span><span class="RktVal">"select * from the_numbers where n = $1"</span><span class="hspace">&nbsp;</span><span class="RktVal">100</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-maybe-row))" class="RktValLink" pltdoc="x">query-maybe-row</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktVal">"select 17"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'#(17)</span></p></td></tr></table></blockquote></td></tr></table></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._query-value))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-value))" class="RktValLink" pltdoc="x">query-value</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">connection</span><span class="hspace">&nbsp;</span><span class="RktVar">stmt</span><span class="hspace">&nbsp;</span><span class="RktVar">arg</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">connection</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="connect.html#(def._((lib._db/main..rkt)._connection~3f))" class="RktValLink" pltdoc="x">connection?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">stmt</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._statement~3f))" class="RktValLink" pltdoc="x">statement?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">arg</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Executes a SQL query, which must produce exactly one row of exactly
  one column, and returns its single value result.</div></p><p><table cellspacing="0" class="RktBlk"><tr><td><p>Examples:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-value))" class="RktValLink" pltdoc="x">query-value</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pgc</span><span class="hspace">&nbsp;</span><span class="RktVal">"select timestamp 'epoch'"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(sql-timestamp 1970 1 1 0 0 0 0 #f)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-value))" class="RktValLink" pltdoc="x">query-value</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pgc</span><span class="hspace">&nbsp;</span><span class="RktVal">"select s from the_numbers where n = $1"</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">"a crowd"</span></p></td></tr></table></blockquote></td></tr></table></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._query-maybe-value))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-maybe-value))" class="RktValLink" pltdoc="x">query-maybe-value</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">connection</span><span class="hspace">&nbsp;</span><span class="RktVar">stmt</span><span class="hspace">&nbsp;</span><span class="RktVar">arg</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._or/c))" class="RktValLink" pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">connection</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="connect.html#(def._((lib._db/main..rkt)._connection~3f))" class="RktValLink" pltdoc="x">connection?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">stmt</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._statement~3f))" class="RktValLink" pltdoc="x">statement?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">arg</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Like <span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-value))" class="RktValLink" pltdoc="x">query-value</a></span>, but the query may produce zero rows; in
  that case, <span class="RktVal">#f</span> is returned.</div></p><p><table cellspacing="0" class="RktBlk"><tr><td><p>Examples:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-value))" class="RktValLink" pltdoc="x">query-value</a></span><span class="hspace">&nbsp;</span><span class="RktSym">myc</span><span class="hspace">&nbsp;</span><span class="RktVal">"select s from some_table where n = ?"</span><span class="hspace">&nbsp;</span><span class="RktVal">100</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-value))" class="RktValLink" pltdoc="x">query-value</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktVal">"select 17"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">17</span></p></td></tr></table></blockquote></td></tr></table></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._in-query))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._in-query))" class="RktValLink" pltdoc="x">in-query</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">connection</span><span class="hspace">&nbsp;</span><span class="RktVar">stmt</span><span class="hspace">&nbsp;</span><span class="RktVar">arg</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/sequences.html#(def._((lib._racket/private/base..rkt)._sequence~3f))" class="RktValLink" pltdoc="x">sequence?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">connection</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="connect.html#(def._((lib._db/main..rkt)._connection~3f))" class="RktValLink" pltdoc="x">connection?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">stmt</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._statement~3f))" class="RktValLink" pltdoc="x">statement?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">arg</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Executes a SQL query, which must produce rows, and returns a
  sequence. Each step in the sequence produces as many values as the
  rows have columns.</div></p><p><table cellspacing="0" class="RktBlk"><tr><td><p>Examples:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/for.html#(form._((lib._racket/private/base..rkt)._for/list))" class="RktStxLink" pltdoc="x">for/list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._in-query))" class="RktValLink" pltdoc="x">in-query</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pgc</span><span class="hspace">&nbsp;</span><span class="RktVal">"select n from the_numbers where n &lt; 2"</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">'(0 1)</span></p></td></tr><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/for.html#(form._((lib._racket/private/base..rkt)._for))" class="RktStxLink" pltdoc="x">for</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">d</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._in-query))" class="RktValLink" pltdoc="x">in-query</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pgc</span><span class="hspace">&nbsp;</span><span class="RktVal">"select * from the_numbers where n &lt; $1"</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Writing.html#(def._((quote._~23~25kernel)._printf))" class="RktValLink" pltdoc="x">printf</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"~a is ~a\n"</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">d</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0"><tr><td><p><span class="RktOut">0: nothing</span></p></td></tr><tr><td><p><span class="RktOut">1: the loneliest number</span></p></td></tr><tr><td><p><span class="RktOut">2: company</span></p></td></tr><tr><td><p><span class="RktOut">3: a crowd</span></p></td></tr></table></td></tr><tr><td><table cellspacing="0"><tr><td></td></tr></table></td></tr></table></blockquote></td></tr></table></p><p>An <span class="RktSym"><a href="#(def._((lib._db/main..rkt)._in-query))" class="RktValLink" pltdoc="x">in-query</a></span> application can provide better performance when
it appears directly in a <span class="RktSym"><a href="../reference/for.html#(form._((lib._racket/private/base..rkt)._for))" class="RktStxLink" pltdoc="x">for</a></span> clause. In addition, it may
perform stricter checks on the number of columns returned by the query
based on the number of variables in the clause&rsquo;s left-hand side:</p><p><table cellspacing="0" class="RktBlk"><tr><td><p>Example:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/for.html#(form._((lib._racket/private/base..rkt)._for))" class="RktStxLink" pltdoc="x">for</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._in-query))" class="RktValLink" pltdoc="x">in-query</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pgc</span><span class="hspace">&nbsp;</span><span class="RktVal">"select * from the_numbers"</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Writing.html#(def._((lib._racket/private/misc..rkt)._displayln))" class="RktValLink" pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktErr">in-query: query returned 2 columns (expected 1): "select *</span></p></td></tr><tr><td><p><span class="RktErr">from the_numbers"</span></p></td></tr></table></blockquote></td></tr></table></p><h4>3.3<tt>&nbsp;</tt><a name="(part._.General_.Query_.Support)"></a>General Query Support</h4><p>A general query result is either a <span class="RktSym"><a href="#(def._((lib._db/main..rkt)._simple-result))" class="RktValLink" pltdoc="x">simple-result</a></span> or a
<span class="RktSym"><a href="#(def._((lib._db/main..rkt)._rows-result))" class="RktValLink" pltdoc="x">rows-result</a></span>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define-struct.html#(form._((lib._racket/private/base..rkt)._struct))" class="RktStxLink" pltdoc="x">struct</a></span><span class="stt"> </span><a name="(def._((lib._db/main..rkt)._simple-result-info))"></a><a name="(def._((lib._db/main..rkt)._simple-result~3f))"></a><a name="(def._((lib._db/main..rkt)._struct~3asimple-result))"></a><a name="(def._((lib._db/main..rkt)._simple-result))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._simple-result))" class="RktValLink" pltdoc="x">simple-result</a></span></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">info</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">info</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Represents the result of a SQL statement that does not return a
relation, such as an <span class="stt">INSERT</span> or <span class="stt">DELETE</span> statement.</div></p><p>The <span class="RktSym">info</span> field is usually an association list, but do not
rely on its contents; it varies based on database system and may
change in future versions of this library (even new minor versions).</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define-struct.html#(form._((lib._racket/private/base..rkt)._struct))" class="RktStxLink" pltdoc="x">struct</a></span><span class="stt"> </span><a name="(def._((lib._db/main..rkt)._rows-result-rows))"></a><a name="(def._((lib._db/main..rkt)._rows-result-headers))"></a><a name="(def._((lib._db/main..rkt)._rows-result~3f))"></a><a name="(def._((lib._db/main..rkt)._struct~3arows-result))"></a><a name="(def._((lib._db/main..rkt)._rows-result))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._rows-result))" class="RktValLink" pltdoc="x">rows-result</a></span></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">headers</span><span class="stt"> </span><span class="RktSym">rows</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">headers</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._listof))" class="RktValLink" pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">rows</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._listof))" class="RktValLink" pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/vectors.html#(def._((quote._~23~25kernel)._vector~3f))" class="RktValLink" pltdoc="x">vector?</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Represents the result of SQL statement that results in a relation,
such as a <span class="stt">SELECT</span> query.</div></p><p>The <span class="RktSym">headers</span> field is a list whose length is the number of
columns in the result rows. Each header is usually an association list
containing information about the column, but do not rely on its
contents; it varies based on the database system and may change in
future version of this library (even new minor versions).</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._query))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query))" class="RktValLink" pltdoc="x">query</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">connection</span><span class="hspace">&nbsp;</span><span class="RktVar">stmt</span><span class="hspace">&nbsp;</span><span class="RktVar">arg</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._or/c))" class="RktValLink" pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._simple-result~3f))" class="RktValLink" pltdoc="x">simple-result?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._rows-result~3f))" class="RktValLink" pltdoc="x">rows-result?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">connection</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="connect.html#(def._((lib._db/main..rkt)._connection~3f))" class="RktValLink" pltdoc="x">connection?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">stmt</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._statement~3f))" class="RktValLink" pltdoc="x">statement?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">arg</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Executes a query, returning a structure that describes the
results. Unlike the more specialized query functions, <span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query))" class="RktValLink" pltdoc="x">query</a></span>
supports both rows-returning and effect-only queries.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><table cellspacing="0" class="prototype"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._group-rows))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._group-rows))" class="RktValLink" pltdoc="x">group-rows</a></span></span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">result</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">#:group</span><span class="hspace">&nbsp;</span><span class="RktVar">grouping-fields</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span>[</td><td><span class="RktPn">#:group-mode</span><span class="hspace">&nbsp;</span><span class="RktVar">group-mode</span>]<span class="RktPn">)</span></td><td><span class="hspace">&nbsp;</span></td><td>&rarr;</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._rows-result~3f))" class="RktValLink" pltdoc="x">rows-result?</a></span></td></tr></table></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">result</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._rows-result~3f))" class="RktValLink" pltdoc="x">rows-result?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">grouping-fields</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._or/c))" class="RktValLink" pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/vector..rkt)._vectorof))" class="RktValLink" pltdoc="x">vectorof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="RktValLink" pltdoc="x">string?</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._listof))" class="RktValLink" pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/vector..rkt)._vectorof))" class="RktValLink" pltdoc="x">vectorof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="RktValLink" pltdoc="x">string?</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">group-mode</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._listof))" class="RktValLink" pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._or/c))" class="RktValLink" pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">preserve-null-rows</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">list</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/pairs.html#(def._((quote._~23~25kernel)._null))" class="RktValLink" pltdoc="x">null</a></span></td></tr></table></blockquote></div><div class="SIntrapara">If <span class="RktVar">grouping-fields</span> is a vector, the elements must be names of
fields in <span class="RktVar">result</span>, and <span class="RktVar">result</span>&rsquo;s rows are regrouped
using the given fields. Each grouped row contains N+1 fields; the
first N fields are the <span class="RktVar">grouping-fields</span>, and the final field
is a list of &ldquo;residual rows&rdquo; over the rest of the fields. A residual
row of all NULLs is dropped (for convenient processing of <span class="stt">OUTER
JOIN</span> results) unless <span class="RktVar">group-mode</span> includes
<span class="RktVal">'</span><span class="RktVal">preserve-null-rows</span>. If <span class="RktVar">group-mode</span> contains
<span class="RktVal">'</span><span class="RktVal">list</span>, there must be exactly one residual field, and its
values are included without a vector wrapper (similar to
<span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-list))" class="RktValLink" pltdoc="x">query-list</a></span>).</div></p><p><table cellspacing="0" class="RktBlk"><tr><td><p>Examples:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">vehicles-result</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._rows-result))" class="RktValLink" pltdoc="x">rows-result</a></span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">name</span><span class="hspace">&nbsp;</span><span class="RktVal">. </span><span class="RktVal">"type"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">name</span><span class="hspace">&nbsp;</span><span class="RktVal">. </span><span class="RktVal">"maker"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">name</span><span class="hspace">&nbsp;</span><span class="RktVal">. </span><span class="RktVal">"model"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">"car"</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">"honda"</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"civic"</span><span class="RktVal">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">"car"</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">"ford"</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"focus"</span><span class="RktVal">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">"car"</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">"ford"</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"pinto"</span><span class="RktVal">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">"bike"</span><span class="hspace">&nbsp;</span><span class="RktVal">"giant"</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"boulder"</span><span class="RktVal">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">"bike"</span><span class="hspace">&nbsp;</span><span class="RktVal">"schwinn"</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym"><a href="sql-types.html#(def._((lib._db/main..rkt)._sql-null))" class="RktValLink" pltdoc="x">sql-null</a></span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0"><tr><td></td></tr></table></td></tr><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._group-rows))" class="RktValLink" pltdoc="x">group-rows</a></span><span class="hspace">&nbsp;</span><span class="RktSym">vehicles-result</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:group</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">"type"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0"><tr><td><p><span class="RktRes">(rows-result</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">'(((name . "type")) ((grouped ((name . "maker")) ((name . "model")))))</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">'(#("car" (#("honda" "civic") #("ford" "focus") #("ford" "pinto")))</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">#("bike" (#("giant" "boulder") #("schwinn" #&lt;sql-null&gt;)))))</span></p></td></tr></table></td></tr></table></blockquote></td></tr></table></p><p>The <span class="RktVar">grouping-fields</span> argument may also be a list of vectors;
in that case, the grouping process is repeated for each set of
grouping fields. The grouping fields must be distinct.</p><p><table cellspacing="0" class="RktBlk"><tr><td><p>Example:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._group-rows))" class="RktValLink" pltdoc="x">group-rows</a></span><span class="hspace">&nbsp;</span><span class="RktSym">vehicles-result</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:group</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">"type"</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">"maker"</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:group-mode</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">list</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0"><tr><td><p><span class="RktRes">(rows-result</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">'(((name . "type"))</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">((grouped ((name . "maker")) ((grouped ((name . "model")))))))</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">'(#("car" (#("honda" ("civic")) #("ford" ("focus" "pinto"))))</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">#("bike" (#("giant" ("boulder")) #("schwinn" ())))))</span></p></td></tr></table></td></tr></table></blockquote></td></tr></table></p><h4>3.4<tt>&nbsp;</tt><a name="(part._.Prepared_.Statements)"></a>Prepared Statements</h4><p>A <a name="(tech._prepared._statement)"></a><span style="font-style: italic">prepared statement</span> is the result of a call to
<span class="RktSym"><a href="#(def._((lib._db/main..rkt)._prepare))" class="RktValLink" pltdoc="x">prepare</a></span>.</p><p>Any server-side or native-library resources associated with a prepared
statement are released when the prepared statement is
garbage-collected or when the connection that owns it is closed;
prepared statements do not need to be (and cannot be) explicitly
closed.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._prepare))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._prepare))" class="RktValLink" pltdoc="x">prepare</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">connection</span><span class="hspace">&nbsp;</span><span class="RktVar">stmt</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._prepared-statement~3f))" class="RktValLink" pltdoc="x">prepared-statement?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">connection</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="connect.html#(def._((lib._db/main..rkt)._connection~3f))" class="RktValLink" pltdoc="x">connection?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">stmt</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._or/c))" class="RktValLink" pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="RktValLink" pltdoc="x">string?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._virtual-statement~3f))" class="RktValLink" pltdoc="x">virtual-statement?</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Prepares a statement. The resulting <a href="#(tech._prepared._statement)" class="techoutside" pltdoc="x"><span class="techinside">prepared statement</span></a> is
tied to the connection that prepared it; attempting to execute it
with another connection will trigger an exception. The prepared
statement holds its connection link weakly; a reference to a
prepared statement will not keep a connection from being garbage
collected.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._prepared-statement~3f))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._prepared-statement~3f))" class="RktValLink" pltdoc="x">prepared-statement?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="RktValLink" pltdoc="x">boolean?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">x</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns <span class="RktVal">#t</span> if <span class="RktVar">x</span> is a <a href="#(tech._prepared._statement)" class="techoutside" pltdoc="x"><span class="techinside">prepared statement</span></a>
created by <span class="RktSym"><a href="#(def._((lib._db/main..rkt)._prepare))" class="RktValLink" pltdoc="x">prepare</a></span>, <span class="RktVal">#f</span> otherwise.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._prepared-statement-parameter-types))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._prepared-statement-parameter-types))" class="RktValLink" pltdoc="x">prepared-statement-parameter-types</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">pst</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._listof))" class="RktValLink" pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._list/c))" class="RktValLink" pltdoc="x">list/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="RktValLink" pltdoc="x">boolean?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._or/c))" class="RktValLink" pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/symbols.html#(def._((quote._~23~25kernel)._symbol~3f))" class="RktValLink" pltdoc="x">symbol?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">pst</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._prepared-statement~3f))" class="RktValLink" pltdoc="x">prepared-statement?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a list with one element for each of the prepared statement&rsquo;s
parameters. Each element is itself a list of the following form:</div></p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym"><a href="../reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="RktValLink" pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVar">supported?</span><span class="hspace">&nbsp;</span><span class="RktVar">type</span><span class="hspace">&nbsp;</span><span class="RktVar">typeid</span><span class="RktPn">)</span></p></blockquote><p>The <span class="RktVar">supported?</span> field indicates whether the type is
supported by this library; the <span class="RktVar">type</span> field is a symbol
corresponding to an entry in one of the tables in
<a href="sql-types.html#(part._db-types)" pltdoc="x">SQL Type Conversions</a>; and the <span class="RktVar">typeid</span> field is a
system-specific type identifier. The type description list format
may be extended with additional information in future versions of
this library.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._prepared-statement-result-types))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._prepared-statement-result-types))" class="RktValLink" pltdoc="x">prepared-statement-result-types</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">pst</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._listof))" class="RktValLink" pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._list/c))" class="RktValLink" pltdoc="x">list/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="RktValLink" pltdoc="x">boolean?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._or/c))" class="RktValLink" pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/symbols.html#(def._((quote._~23~25kernel)._symbol~3f))" class="RktValLink" pltdoc="x">symbol?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">pst</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._prepared-statement~3f))" class="RktValLink" pltdoc="x">prepared-statement?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">If <span class="RktVar">pst</span> is a rows-returning statement (eg, <span class="stt">SELECT</span>),
returns a list of type descriptions as described above, identifying
the SQL types (or pseudotypes) of the result columns. If
<span class="RktVar">pst</span> is not a rows-returning statement, the function returns
the empty list.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._bind-prepared-statement))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._bind-prepared-statement))" class="RktValLink" pltdoc="x">bind-prepared-statement</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">pst</span><span class="hspace">&nbsp;</span><span class="RktVar">params</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._statement-binding~3f))" class="RktValLink" pltdoc="x">statement-binding?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">pst</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._prepared-statement~3f))" class="RktValLink" pltdoc="x">prepared-statement?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">params</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._listof))" class="RktValLink" pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Creates a statement-binding value pairing <span class="RktVar">pst</span> with
<span class="RktVar">params</span>, a list of parameter arguments. The result can be
executed with <span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query))" class="RktValLink" pltdoc="x">query</a></span> or any of the other query functions,
but it must be used with the same connection that created
<span class="RktVar">pst</span>.</div></p><p><table cellspacing="0" class="RktBlk"><tr><td><p>Example:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let*))" class="RktStxLink" pltdoc="x">let*</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">get-name-pst</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._prepare))" class="RktValLink" pltdoc="x">prepare</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pgc</span><span class="hspace">&nbsp;</span><span class="RktVal">"select d from the_numbers where n = $1"</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">get-name2</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._bind-prepared-statement))" class="RktValLink" pltdoc="x">bind-prepared-statement</a></span><span class="hspace">&nbsp;</span><span class="RktSym">get-name-pst</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="RktValLink" pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">get-name3</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._bind-prepared-statement))" class="RktValLink" pltdoc="x">bind-prepared-statement</a></span><span class="hspace">&nbsp;</span><span class="RktSym">get-name-pst</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="RktValLink" pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="RktValLink" pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-value))" class="RktValLink" pltdoc="x">query-value</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pgc</span><span class="hspace">&nbsp;</span><span class="RktSym">get-name2</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-value))" class="RktValLink" pltdoc="x">query-value</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pgc</span><span class="hspace">&nbsp;</span><span class="RktSym">get-name3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">'("company" "a crowd")</span></p></td></tr></table></blockquote></td></tr></table></p><p>Most query functions perform the binding step implicitly.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._statement-binding~3f))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._statement-binding~3f))" class="RktValLink" pltdoc="x">statement-binding?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="RktValLink" pltdoc="x">boolean?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">x</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns <span class="RktVal">#t</span> if <span class="RktVar">x</span> is a statement created by
<span class="RktSym"><a href="#(def._((lib._db/main..rkt)._bind-prepared-statement))" class="RktValLink" pltdoc="x">bind-prepared-statement</a></span>, <span class="RktVal">#f</span> otherwise.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._virtual-statement))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._virtual-statement))" class="RktValLink" pltdoc="x">virtual-statement</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">gen</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._virtual-statement~3f))" class="RktValLink" pltdoc="x">virtual-statement?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">gen</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._or/c))" class="RktValLink" pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="RktValLink" pltdoc="x">string?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/function-contracts.html#(form._((lib._racket/contract/base..rkt)._-~3e))" class="RktStxLink" pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="connect.html#(def._((lib._db/main..rkt)._dbsystem~3f))" class="RktValLink" pltdoc="x">dbsystem?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="RktValLink" pltdoc="x">string?</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Creates a <a name="(tech._virtual._statement)"></a><span style="font-style: italic">virtual statement</span>, <span class="RktVar">stmt</span>, which
  encapsulates a weak mapping of connections to prepared
  statements. When a query function is called with <span class="RktVar">stmt</span> and
  a connection, the weak hash is consulted to see if the statement has
  already been prepared for that connection. If so, the prepared
  statement is used; otherwise, the statement is prepared and stored
  in the table.</div></p><p>The <span class="RktVar">gen</span> argument must be either a SQL string or a function
  that accepts a databse system object and produces a SQL string. The
  function variant allows the SQL syntax to be dynamically customized
  for the database system in use.</p><p><table cellspacing="0" class="RktBlk"><tr><td><p>Examples:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pst</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._virtual-statement))" class="RktValLink" pltdoc="x">virtual-statement</a></span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="RktStxLink" pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">dbsys</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))" class="RktStxLink" pltdoc="x">case</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="connect.html#(def._((lib._db/main..rkt)._dbsystem-name))" class="RktValLink" pltdoc="x">dbsystem-name</a></span><span class="hspace">&nbsp;</span><span class="RktSym">dbsys</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">postgresql</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"select n from the_numbers where n &lt; $1"</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">sqlite3</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"select n from the_numbers where n &lt; ?"</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))" class="RktStxLink" pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/exns.html#(def._((quote._~23~25kernel)._error))" class="RktValLink" pltdoc="x">error</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"unknown system"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0"><tr><td></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-list))" class="RktValLink" pltdoc="x">query-list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pgc</span><span class="hspace">&nbsp;</span><span class="RktSym">pst</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(1 2)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query-list))" class="RktValLink" pltdoc="x">query-list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">slc</span><span class="hspace">&nbsp;</span><span class="RktSym">pst</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(1 2)</span></p></td></tr></table></blockquote></td></tr></table></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._virtual-statement~3f))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._virtual-statement~3f))" class="RktValLink" pltdoc="x">virtual-statement?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="RktValLink" pltdoc="x">boolean?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">x</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns <span class="RktVal">#t</span> if <span class="RktVar">x</span> is a <a href="#(tech._virtual._statement)" class="techoutside" pltdoc="x"><span class="techinside">virtual statement</span></a>
created by <span class="RktSym"><a href="#(def._((lib._db/main..rkt)._virtual-statement))" class="RktValLink" pltdoc="x">virtual-statement</a></span>, <span class="RktVal">#f</span> otherwise.</div></p><h4>3.5<tt>&nbsp;</tt><a name="(part._transactions)"></a>Transactions</h4><p>The functions described in this section provide a consistent interface
to transactions.</p><p>A <a name="(tech._managed._transaction)"></a><span style="font-style: italic">managed transaction</span> is one created via either
<span class="RktSym"><a href="#(def._((lib._db/main..rkt)._start-transaction))" class="RktValLink" pltdoc="x">start-transaction</a></span> or <span class="RktSym"><a href="#(def._((lib._db/main..rkt)._call-with-transaction))" class="RktValLink" pltdoc="x">call-with-transaction</a></span>. In
contrast, an <a name="(tech._unmanaged._transaction)"></a><span style="font-style: italic">unmanaged transaction</span> is one created by
evaluating a SQL statement such as <span class="stt">START TRANSACTION</span>. A
<a name="(tech._nested._transaction)"></a><span style="font-style: italic">nested transaction</span> is a transaction created within the
extent of an existing transaction. If a nested transaction is
committed, its changes are promoted to the enclosing transaction,
which may itself be committed or rolled back. If a nested transaction
is rolled back, its changes are discarded, but the enclosing
transaction remains open. Nested transactions are implemented via SQL
<span class="stt">SAVEPOINT</span>, <span class="stt">RELEASE SAVEPOINT</span>, and <span class="stt">ROLLBACK TO
SAVEPOINT</span>.</p><p>ODBC connections must use <a href="#(tech._managed._transaction)" class="techoutside" pltdoc="x"><span class="techinside">managed transactions</span></a> exclusively;
using transaction-changing SQL may cause these functions to behave
incorrectly and may cause additional problems in the ODBC driver. ODBC
connections do not support <a href="#(tech._nested._transaction)" class="techoutside" pltdoc="x"><span class="techinside">nested transactions</span></a>.</p><p>PostgreSQL, MySQL, and SQLite connections must not mix <a href="#(tech._managed._transaction)" class="techoutside" pltdoc="x"><span class="techinside">managed</span></a> and <a href="#(tech._unmanaged._transaction)" class="techoutside" pltdoc="x"><span class="techinside">unmanaged</span></a> transactions. For example, calling
<span class="RktSym"><a href="#(def._((lib._db/main..rkt)._start-transaction))" class="RktValLink" pltdoc="x">start-transaction</a></span> and then executing a <span class="stt">ROLLBACK</span>
statement is not allowed. Note that in MySQL, some SQL statements have
<a href="http://dev.mysql.com/doc/refman/5.0/en/implicit-commit.html">implicit
transaction effects</a>. For example, in MySQL a <span class="stt">CREATE TABLE</span>
statement implicitly commits the current transaction. These statements
also must not be used within <a href="#(tech._managed._transaction)" class="techoutside" pltdoc="x"><span class="techinside">managed transactions</span></a>. (In
contrast, PostgreSQL and SQLite both support transactional DDL.)</p><p><div class="SIntrapara"><span style="font-weight: bold">Errors</span> Query errors may affect an open transaction in one of
three ways:
</div><div class="SIntrapara"><ol><li><p>the transaction remains open and unchanged</p></li><li><p>the transaction is automatically rolled back</p></li><li><p>the transaction becomes an <a name="(tech._invalid._transaction)"></a><span style="font-style: italic">invalid transaction</span>; all
subsequent queries will fail until the transaction is rolled back</p></li></ol></div><div class="SIntrapara">To avoid the silent loss of information, this library attempts to
avoid behavior (2) completely by marking transactions as invalid
instead (3). Invalid transactions can be identified using the
<span class="RktSym"><a href="#(def._((lib._db/main..rkt)._needs-rollback~3f))" class="RktValLink" pltdoc="x">needs-rollback?</a></span> function. The following list is a rough guide
to what errors cause which behaviors:
</div><div class="SIntrapara"><ul><li><p>All errors raised by checks performed by this library, such as
parameter arity and type errors, leave the transaction open and
unchanged (1).</p></li><li><p>All errors originating from PostgreSQL cause the transaction to
become <a href="#(tech._invalid._transaction)" class="techoutside" pltdoc="x"><span class="techinside">invalid</span></a> (3).</p></li><li><p>Most errors originating from MySQL leave the transaction open
and unchanged (1), but a few cause the transaction to become
<a href="#(tech._invalid._transaction)" class="techoutside" pltdoc="x"><span class="techinside">invalid</span></a> (3). In the latter
cases, the underlying behavior of MySQL is to roll back the
transaction but <span style="font-style: italic">leave it open</span> (see
<a href="http://dev.mysql.com/doc/refman/5.1/en/innodb-error-handling.html">the
MySQL documentation</a>). This library detects those cases and marks
the transaction <a href="#(tech._invalid._transaction)" class="techoutside" pltdoc="x"><span class="techinside">invalid</span></a>
instead.</p></li><li><p>Most errors originating from SQLite leave the transaction open
and unchanged (1), but a few cause the transaction to become
<a href="#(tech._invalid._transaction)" class="techoutside" pltdoc="x"><span class="techinside">invalid</span></a> (3). In the latter
cases, the underlying behavior of SQLite is to roll back the
transaction (see
<a href="http://www.sqlite.org/lang_transaction.html">the SQLite
documentation</a>). This library detects those cases and marks the
transaction <a href="#(tech._invalid._transaction)" class="techoutside" pltdoc="x"><span class="techinside">invalid</span></a> instead.</p></li><li><p>All errors originating from an ODBC driver cause the transaction
to become <a href="#(tech._invalid._transaction)" class="techoutside" pltdoc="x"><span class="techinside">invalid</span></a> (3). The
underlying behavior of ODBC drivers varies widely, and ODBC provides
no mechanism to detect when an existing transaction has been rolled
back, so this library intercepts all errors and marks the
transaction <a href="#(tech._invalid._transaction)" class="techoutside" pltdoc="x"><span class="techinside">invalid</span></a> instead.</p></li></ul></div><div class="SIntrapara">If a nested transaction marked <a href="#(tech._invalid._transaction)" class="techoutside" pltdoc="x"><span class="techinside">invalid</span></a> is rolled back, the enclosing transaction is
typically still valid.</div></p><p>If a transaction is open when a connection is disconnected, it is
implicitly rolled back.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><table cellspacing="0" class="prototype"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._start-transaction))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._start-transaction))" class="RktValLink" pltdoc="x">start-transaction</a></span></span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">c</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span>[</td><td><span class="RktPn">#:isolation</span><span class="hspace">&nbsp;</span><span class="RktVar">isolation-level</span>]<span class="RktPn">)</span></td><td><span class="hspace">&nbsp;</span></td><td>&rarr;</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="../reference/void.html#(def._((quote._~23~25kernel)._void~3f))" class="RktValLink" pltdoc="x">void?</a></span></td></tr></table></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">c</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="connect.html#(def._((lib._db/main..rkt)._connection~3f))" class="RktValLink" pltdoc="x">connection?</a></span></td></tr><tr><td><table cellspacing="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">isolation-level</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._or/c))" class="RktValLink" pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">serializable</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">repeatable-read</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">read-committed</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">read-uncommitted</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr></table></td><td><span class="hspace">&nbsp;</span></td><td>=</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVal">#f</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Starts a transaction with isolation <span class="RktVar">isolation-level</span>. If
<span class="RktVar">isolation-level</span> is <span class="RktVal">#f</span>, the isolation is
database-dependent; it may be a default isolation level or it may be
the isolation level of the previous transaction.</div></p><p>If <span class="RktVar">c</span> is already in a transaction, <span class="RktVar">isolation-level</span>
must be <span class="RktVal">#f</span>, and a <a href="#(tech._nested._transaction)" class="techoutside" pltdoc="x"><span class="techinside">nested transaction</span></a> is opened.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._commit-transaction))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._commit-transaction))" class="RktValLink" pltdoc="x">commit-transaction</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">c</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#(def._((quote._~23~25kernel)._void~3f))" class="RktValLink" pltdoc="x">void?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">c</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="connect.html#(def._((lib._db/main..rkt)._connection~3f))" class="RktValLink" pltdoc="x">connection?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Attempts to commit the current transaction, if one is open. If the
transaction cannot be commited (for example, if it is <a href="#(tech._invalid._transaction)" class="techoutside" pltdoc="x"><span class="techinside">invalid</span></a>), an exception is raised.</div></p><p>If the current transaction is a <a href="#(tech._nested._transaction)" class="techoutside" pltdoc="x"><span class="techinside">nested transaction</span></a>, the
nested transaction is closed, its changes are incorporated into the
enclosing transaction, and the enclosing transaction is resumed.</p><p>If no transaction is open, this function has no effect.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._rollback-transaction))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._rollback-transaction))" class="RktValLink" pltdoc="x">rollback-transaction</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">c</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#(def._((quote._~23~25kernel)._void~3f))" class="RktValLink" pltdoc="x">void?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">c</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="connect.html#(def._((lib._db/main..rkt)._connection~3f))" class="RktValLink" pltdoc="x">connection?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Rolls back the current transaction, if one is open.</div></p><p>If the current transaction is a <a href="#(tech._nested._transaction)" class="techoutside" pltdoc="x"><span class="techinside">nested transaction</span></a>, the
nested transaction is closed, its changes are abandoned, and the
enclosing transaction is resumed.</p><p>If no transaction is open, this function has no effect.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._in-transaction~3f))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._in-transaction~3f))" class="RktValLink" pltdoc="x">in-transaction?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">c</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="RktValLink" pltdoc="x">boolean?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">c</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="connect.html#(def._((lib._db/main..rkt)._connection~3f))" class="RktValLink" pltdoc="x">connection?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns <span class="RktVal">#t</span> if <span class="RktVar">c</span> has an open transaction
(<a href="#(tech._managed._transaction)" class="techoutside" pltdoc="x"><span class="techinside">managed</span></a> or <a href="#(tech._unmanaged._transaction)" class="techoutside" pltdoc="x"><span class="techinside">unmanaged</span></a>), <span class="RktVal">#f</span> otherwise.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._needs-rollback~3f))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._needs-rollback~3f))" class="RktValLink" pltdoc="x">needs-rollback?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">c</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="RktValLink" pltdoc="x">boolean?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">c</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="connect.html#(def._((lib._db/main..rkt)._connection~3f))" class="RktValLink" pltdoc="x">connection?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns <span class="RktVal">#t</span> if <span class="RktVar">c</span> is in an <a href="#(tech._invalid._transaction)" class="techoutside" pltdoc="x"><span class="techinside">invalid
transaction</span></a>. All queries executed using <span class="RktVar">c</span> will fail until
the transaction is rolled back (either using
<span class="RktSym"><a href="#(def._((lib._db/main..rkt)._rollback-transaction))" class="RktValLink" pltdoc="x">rollback-transaction</a></span>, if the transaction was created with
<span class="RktSym"><a href="#(def._((lib._db/main..rkt)._start-transaction))" class="RktValLink" pltdoc="x">start-transaction</a></span>, or when the procedure passed to
<span class="RktSym"><a href="#(def._((lib._db/main..rkt)._call-with-transaction))" class="RktValLink" pltdoc="x">call-with-transaction</a></span> returns).</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><table cellspacing="0" class="prototype"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._call-with-transaction))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._call-with-transaction))" class="RktValLink" pltdoc="x">call-with-transaction</a></span></span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">c</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">proc</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span>[</td><td><span class="RktPn">#:isolation</span><span class="hspace">&nbsp;</span><span class="RktVar">isolation-level</span>]<span class="RktPn">)</span></td><td><span class="hspace">&nbsp;</span></td><td>&rarr;</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="../reference/data-structure-contracts.html#(form._((lib._racket/contract/private/misc..rkt)._any))" class="RktStxLink" pltdoc="x">any</a></span></td></tr></table></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">c</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="connect.html#(def._((lib._db/main..rkt)._connection~3f))" class="RktValLink" pltdoc="x">connection?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">proc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/function-contracts.html#(form._((lib._racket/contract/base..rkt)._-~3e))" class="RktStxLink" pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(form._((lib._racket/contract/private/misc..rkt)._any))" class="RktStxLink" pltdoc="x">any</a></span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">isolation-level</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._or/c))" class="RktValLink" pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">serializable</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">repeatable-read</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">read-committed</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">read-uncommitted</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr></table></td><td><span class="hspace">&nbsp;</span></td><td>=</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVal">#f</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Calls <span class="RktVar">proc</span> in the context of a new transaction with
isolation level <span class="RktVar">isolation-level</span>. If <span class="RktVar">proc</span> completes
normally, the transaction is committed and <span class="RktVar">proc</span>&rsquo;s results
are returned. If <span class="RktVar">proc</span> raises an exception (or if the
implicit commit at the end raises an exception), the transaction is
rolled back and the exception is re-raised.</div></p><p><div class="SIntrapara">If <span class="RktSym"><a href="#(def._((lib._db/main..rkt)._call-with-transaction))" class="RktValLink" pltdoc="x">call-with-transaction</a></span> is called within a transaction,
<span class="RktVar">isolation-level</span> must be <span class="RktVal">#f</span>, and it creates a
<a href="#(tech._nested._transaction)" class="techoutside" pltdoc="x"><span class="techinside">nested transaction</span></a>. Within the extent of a call to
<span class="RktSym"><a href="#(def._((lib._db/main..rkt)._call-with-transaction))" class="RktValLink" pltdoc="x">call-with-transaction</a></span>, transactions must be properly
nested. In particular:
</div><div class="SIntrapara"><ul><li><p>Calling either <span class="RktSym"><a href="#(def._((lib._db/main..rkt)._commit-transaction))" class="RktValLink" pltdoc="x">commit-transaction</a></span> or
<span class="RktSym"><a href="#(def._((lib._db/main..rkt)._rollback-transaction))" class="RktValLink" pltdoc="x">rollback-transaction</a></span> when the open transaction was
created by <span class="RktSym"><a href="#(def._((lib._db/main..rkt)._call-with-transaction))" class="RktValLink" pltdoc="x">call-with-transaction</a></span> causes an exception to be
raised.</p></li><li><p>If a further nested transaction is open when <span class="RktVar">proc</span>
completes (that is, created by an unmatched
<span class="RktSym"><a href="#(def._((lib._db/main..rkt)._start-transaction))" class="RktValLink" pltdoc="x">start-transaction</a></span> call), an exception is raised and the
nested transaction created by <span class="RktSym"><a href="#(def._((lib._db/main..rkt)._call-with-transaction))" class="RktValLink" pltdoc="x">call-with-transaction</a></span> is
rolled back.</p></li></ul></div></p><h4>3.6<tt>&nbsp;</tt><a name="(part._.S.Q.L_.Errors)"></a>SQL Errors</h4><p>SQL errors are represented by the <span class="RktSym"><a href="#(def._((lib._db/main..rkt)._exn~3afail~3asql))" class="RktValLink" pltdoc="x">exn:fail:sql</a></span> exception
type.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><table cellspacing="0"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define-struct.html#(form._((lib._racket/private/base..rkt)._struct))" class="RktStxLink" pltdoc="x">struct</a></span></td><td><span class="hspace">&nbsp;</span></td><td><a name="(def._((lib._db/main..rkt)._exn~3afail~3asql-info))"></a><a name="(def._((lib._db/main..rkt)._exn~3afail~3asql-sqlstate))"></a><a name="(def._((lib._db/main..rkt)._make-exn~3afail~3asql))"></a><a name="(def._((lib._db/main..rkt)._exn~3afail~3asql~3f))"></a><a name="(def._((lib._db/main..rkt)._struct~3aexn~3afail~3asql))"></a><a name="(def._((lib._db/main..rkt)._exn~3afail~3asql))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._exn~3afail~3asql))" class="RktValLink" pltdoc="x">exn:fail:sql</a></span></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/exns.html#(def._((lib._racket/private/base..rkt)._exn~3afail))" class="RktValLink" pltdoc="x">exn:fail</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">sqlstate</span><span class="stt"> </span><span class="RktSym">info</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">#:extra-constructor-name</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._make-exn~3afail~3asql))" class="RktValLink" pltdoc="x">make-exn:fail:sql</a></span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">sqlstate</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="RktValLink" pltdoc="x">string?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">info</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._listof))" class="RktValLink" pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._cons/c))" class="RktValLink" pltdoc="x">cons/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/symbols.html#(def._((quote._~23~25kernel)._symbol~3f))" class="RktValLink" pltdoc="x">symbol?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Represents a SQL error originating from the database server or
  native library. The <span class="RktSym">sqlstate</span> field contains the SQLSTATE
  code (a five-character string) of the error; refer to the database
  system&rsquo;s documentation for the definitions of SQLSTATE codes. The
  <span class="RktSym">info</span> field contains all information available about the
  error as an association list. The available keys vary, but the
  <span class="RktVal">'</span><span class="RktVal">message</span> key is typically present; its value is a string
  containing the error message.</div></p><p><table cellspacing="0" class="RktBlk"><tr><td><p>Example:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/exns.html#(form._((lib._racket/private/more-scheme..rkt)._with-handlers))" class="RktStxLink" pltdoc="x">with-handlers</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._exn~3afail~3asql~3f))" class="RktValLink" pltdoc="x">exn:fail:sql?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._exn~3afail~3asql-info))" class="RktValLink" pltdoc="x">exn:fail:sql-info</a></span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._query))" class="RktValLink" pltdoc="x">query</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pgc</span><span class="hspace">&nbsp;</span><span class="RktVal">"select * from nosuchtable"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0"><tr><td><p><span class="RktRes">'((severity . "ERROR")</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">(code . "42P01")</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">(message . "relation \"nosuchtable\" does not exist")</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">...)</span></p></td></tr></table></td></tr></table></blockquote></td></tr></table></p><p>Errors originating from the <a href="index.html" class="RktModLink" pltdoc="x"><span class="RktSym">db</span></a> library, such as
  arity and contract errors, type conversion errors, etc, are not
  represented by <span class="RktSym"><a href="#(def._((lib._db/main..rkt)._exn~3afail~3asql))" class="RktValLink" pltdoc="x">exn:fail:sql</a></span>. SQLite errors are not
  represented via <span class="RktSym"><a href="#(def._((lib._db/main..rkt)._exn~3afail~3asql))" class="RktValLink" pltdoc="x">exn:fail:sql</a></span>, because SQLite does not
  provide SQLSTATE error codes.</p><h4>3.7<tt>&nbsp;</tt><a name="(part._.Database_.Catalog_.Information)"></a>Database Catalog Information</h4><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._list-tables))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._list-tables))" class="RktValLink" pltdoc="x">list-tables</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">c</span><span class="hspace">&nbsp;</span>[<span class="RktPn">#:schema</span><span class="hspace">&nbsp;</span><span class="RktVar">schema</span>]<span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._listof))" class="RktValLink" pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="RktValLink" pltdoc="x">string?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">c</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="connect.html#(def._((lib._db/main..rkt)._connection~3f))" class="RktValLink" pltdoc="x">connection?</a></span></td></tr><tr><td><table cellspacing="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">schema</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._or/c))" class="RktValLink" pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">search-or-current</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">search</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">current</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td>=</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVal">'</span><span class="RktVal">search-or-current</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Returns a list of unqualified names of tables (and views) defined in
the current database.</div></p><p>If <span class="RktVar">schema</span> is <span class="RktVal">'</span><span class="RktVal">search</span>, the list contains all tables
in the current schema search path (with the possible exception of
system tables); if the search path cannot be determined, an exception
is raised. If <span class="RktVar">schema</span> is <span class="RktVal">'</span><span class="RktVal">current</span>, the list contains
all tables in the current schema. If <span class="RktVar">schema</span> is
<span class="RktVal">'</span><span class="RktVal">search-or-current</span> (the default), the search path is used if
it can be determined; otherwise the current schema is used.
The schema search path cannot be determined for ODBC-based
connections.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><table cellspacing="0" class="prototype"><tr><td><span class="RktPn">(</span><a name="(def._((lib._db/main..rkt)._table-exists~3f))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._table-exists~3f))" class="RktValLink" pltdoc="x">table-exists?</a></span></span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">c</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">table-name</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span>[</td><td><span class="RktPn">#:schema</span><span class="hspace">&nbsp;</span><span class="RktVar">schema</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">#:case-sensitive?</span><span class="hspace">&nbsp;</span><span class="RktVar">case-sensitive?</span>]<span class="RktPn">)</span></td><td><span class="hspace">&nbsp;</span></td><td>&rarr;</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="../reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="RktValLink" pltdoc="x">boolean?</a></span></td></tr></table></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">c</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="connect.html#(def._((lib._db/main..rkt)._connection~3f))" class="RktValLink" pltdoc="x">connection?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">table-name</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="RktValLink" pltdoc="x">string?</a></span></td></tr><tr><td><table cellspacing="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">schema</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._or/c))" class="RktValLink" pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">search-or-current</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">search</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">current</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td>=</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVal">'</span><span class="RktVal">search-or-current</span></td></tr></table></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">case-sensitive?</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr></table></blockquote></div><div class="SIntrapara">Indicates whether a table (or view) named <span class="RktVar">table-name</span>
exists. The meaning of the <span class="RktVar">schema</span> argument is the same as for
<span class="RktSym"><a href="#(def._((lib._db/main..rkt)._list-tables))" class="RktValLink" pltdoc="x">list-tables</a></span>, and the <span class="RktVar">case-sensitive?</span> argument
controls how table names are compared.</div></p><h4>3.8<tt>&nbsp;</tt><a name="(part._.Creating_.New_.Kinds_of_.Statements)"></a>Creating New Kinds of Statements</h4><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><table cellspacing="0" class="argcontract"><tr><td><a name="(def._((lib._db/main..rkt)._prop~3astatement))"></a><span title="Provided from: db, db/base"><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._prop~3astatement))" class="RktValLink" pltdoc="x">prop:statement</a></span></span></td><td><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span></td><td><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Structure_Type_Property_Contracts.html#(def._((lib._racket/contract..rkt)._struct-type-property/c))" class="RktValLink" pltdoc="x">struct-type-property/c</a></span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/function-contracts.html#(form._((lib._racket/contract/base..rkt)._-~3e))" class="RktStxLink" pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="connect.html#(def._((lib._db/main..rkt)._connection~3f))" class="RktValLink" pltdoc="x">connection?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._db/main..rkt)._statement~3f))" class="RktValLink" pltdoc="x">statement?</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">A struct type property for creating new kinds of statements. The
property value is applied to the struct instance and a connection, and
it must return a <a href="#(tech._statement)" class="techoutside" pltdoc="x"><span class="techinside">statement</span></a>.</div></p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.2.1&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.2.1&quot;);">top</a></span><span class="navright"><a href="connect.html" title="backward to &quot;2 Connections&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;DB: Database Connectivity&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<a href="sql-types.html" title="forward to &quot;4 SQL Types and Conversions&quot;" pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>