<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text-html; charset=utf-8" /><title>2&nbsp;GC Collector Scheme</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default" /><link rel="stylesheet" type="text/css" href="../racket.css" title="default" /><link rel="stylesheet" type="text/css" href="../scribble-style.css" title="default" /><script type="text/javascript" src="../scribble-common.js"></script></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist" style="margin-bottom: 1em;"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" pltdoc="x"><span style="font-style: italic">Programming Languages:<span class="mywbr"> </span> Application and Interpretation</span></a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="plai-scheme.html" class="tocviewlink" pltdoc="x">PLAI Scheme</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="" class="tocviewselflink" pltdoc="x">GC Collector Scheme</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="mutator.html" class="tocviewlink" pltdoc="x">GC Mutator Scheme</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="web.html" class="tocviewlink" pltdoc="x">Web Application Scheme</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>2&nbsp;</td><td><a href="" class="tocviewselflink" pltdoc="x">GC Collector Scheme</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">2.1&nbsp;</td><td><a href="#(part._.Garbage_.Collector_.Interface)" class="tocviewlink" pltdoc="x">Garbage Collector Interface</a></td></tr><tr><td align="right">2.2&nbsp;</td><td><a href="#(part._.Garbage_.Collector_.Exports)" class="tocviewlink" pltdoc="x">Garbage Collector Exports</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">2.1<tt>&nbsp;</tt></span><a href="#(part._.Garbage_.Collector_.Interface)" class="tocsubseclink" pltdoc="x">Garbage Collector Interface</a></td></tr><tr><td><a href="#(def._((lib._plai/collector..rkt)._heap-size))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: plai/collector"><span class="RktSym"><span class="RktValLink">heap-<wbr></wbr>size</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._plai/collector..rkt)._location~3f))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: plai/collector"><span class="RktSym"><span class="RktValLink">location?</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._plai/collector..rkt)._root~3f))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: plai/collector"><span class="RktSym"><span class="RktValLink">root?</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._plai/collector..rkt)._heap-value~3f))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: plai/collector"><span class="RktSym"><span class="RktValLink">heap-<wbr></wbr>value?</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._plai/collector..rkt)._heap-set!))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: plai/collector"><span class="RktSym"><span class="RktValLink">heap-<wbr></wbr>set!</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._plai/collector..rkt)._heap-ref))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: plai/collector"><span class="RktSym"><span class="RktValLink">heap-<wbr></wbr>ref</span></span></span></a></td></tr><tr><td><a href="#(form._((lib._plai/collector..rkt)._get-root-set))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: plai/collector"><span class="RktSym"><span class="RktStxLink">get-<wbr></wbr>root-<wbr></wbr>set</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._plai/collector..rkt)._read-root))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: plai/collector"><span class="RktSym"><span class="RktValLink">read-<wbr></wbr>root</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._plai/collector..rkt)._set-root!))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: plai/collector"><span class="RktSym"><span class="RktValLink">set-<wbr></wbr>root!</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._plai/collector..rkt)._procedure-roots))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: plai/collector"><span class="RktSym"><span class="RktValLink">procedure-<wbr></wbr>roots</span></span></span></a></td></tr><tr><td><a href="#(form._((lib._plai/collector..rkt)._with-heap))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: plai/collector"><span class="RktSym"><span class="RktStxLink">with-<wbr></wbr>heap</span></span></span></a></td></tr><tr><td><span class="tocsublinknumber">2.2<tt>&nbsp;</tt></span><a href="#(part._.Garbage_.Collector_.Exports)" class="tocsubseclink" pltdoc="x">Garbage Collector Exports</a></td></tr><tr><td><a href="#(def._((lib._plai/scribblings/fake-collector..rkt)._init-allocator))" class="tocsubnonseclink" pltdoc="x"><span class="RktSym"><span class="RktValLink">init-<wbr></wbr>allocator</span></span></a></td></tr><tr><td><a href="#(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3aderef))" class="tocsubnonseclink" pltdoc="x"><span class="RktSym"><span class="RktValLink">gc:<span class="mywbr"> </span>deref</span></span></a></td></tr><tr><td><a href="#(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3aalloc-flat))" class="tocsubnonseclink" pltdoc="x"><span class="RktSym"><span class="RktValLink">gc:<span class="mywbr"> </span>alloc-<wbr></wbr>flat</span></span></a></td></tr><tr><td><a href="#(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3acons))" class="tocsubnonseclink" pltdoc="x"><span class="RktSym"><span class="RktValLink">gc:<span class="mywbr"> </span>cons</span></span></a></td></tr><tr><td><a href="#(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3afirst))" class="tocsubnonseclink" pltdoc="x"><span class="RktSym"><span class="RktValLink">gc:<span class="mywbr"> </span>first</span></span></a></td></tr><tr><td><a href="#(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3arest))" class="tocsubnonseclink" pltdoc="x"><span class="RktSym"><span class="RktValLink">gc:<span class="mywbr"> </span>rest</span></span></a></td></tr><tr><td><a href="#(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3aset-first!))" class="tocsubnonseclink" pltdoc="x"><span class="RktSym"><span class="RktValLink">gc:<span class="mywbr"> </span>set-<wbr></wbr>first!</span></span></a></td></tr><tr><td><a href="#(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3aset-rest!))" class="tocsubnonseclink" pltdoc="x"><span class="RktSym"><span class="RktValLink">gc:<span class="mywbr"> </span>set-<wbr></wbr>rest!</span></span></a></td></tr><tr><td><a href="#(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3acons~3f))" class="tocsubnonseclink" pltdoc="x"><span class="RktSym"><span class="RktValLink">gc:<span class="mywbr"> </span>cons?</span></span></a></td></tr><tr><td><a href="#(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3aflat~3f))" class="tocsubnonseclink" pltdoc="x"><span class="RktSym"><span class="RktValLink">gc:<span class="mywbr"> </span>flat?</span></span></a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.2.1&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.2.1&quot;);">top</a></span><span class="navright"><a href="plai-scheme.html" title="backward to &quot;1 PLAI Scheme&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Programming Languages: Application and Interpretation&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<a href="mutator.html" title="forward to &quot;3 GC Mutator Scheme&quot;" pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3>2<tt>&nbsp;</tt><a name="(part._collector)"></a><a name="(mod-path._plai/collector)"></a>GC Collector Scheme</h3><p><table cellspacing="0" class="defmodule"><tr><td><span class="hspace">&nbsp;</span><a href="../guide/Module_Syntax.html#(part._hash-lang)" class="RktModLink" pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="" class="RktModLink" pltdoc="x"><span class="RktSym">plai/collector</span></a></td></tr></table></p><p>GC Collector Scheme is based on <a href="plai-scheme.html" pltdoc="x">PLAI Scheme</a>.  It provides
additional procedures and syntax for writing garbage collectors.</p><h4>2.1<tt>&nbsp;</tt><a name="(part._.Garbage_.Collector_.Interface)"></a>Garbage Collector Interface</h4><p>The GC Collector Scheme language provides the following functions that provide access
to the heap and root set:</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._plai/collector..rkt)._heap-size))"></a><span title="Provided from: plai/collector"><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._heap-size))" class="RktValLink" pltdoc="x">heap-size</a></span></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="RktValLink" pltdoc="x">exact-nonnegative-integer?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns the size of the heap.  The size of the heap is specified by the mutator
that uses the garbage collector.  See <span class="RktSym"><a href="mutator.html#(form._((lib._plai/scribblings/fake-mutator..rkt)._allocator-setup))" class="RktStxLink" pltdoc="x">allocator-setup</a></span> for more
information.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._plai/collector..rkt)._location~3f))"></a><span title="Provided from: plai/collector"><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._location~3f))" class="RktValLink" pltdoc="x">location?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="RktValLink" pltdoc="x">boolean?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Determines if <span class="RktVar">v</span> is an integer between <span class="RktVal">0</span> and
<span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" class="RktValLink" pltdoc="x"><span class="nobreak">-</span></a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._heap-size))" class="RktValLink" pltdoc="x">heap-size</a></span><span class="RktPn">)</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktPn">)</span> inclusive.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._plai/collector..rkt)._root~3f))"></a><span title="Provided from: plai/collector"><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._root~3f))" class="RktValLink" pltdoc="x">root?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="RktValLink" pltdoc="x">boolean?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Determines if <span class="RktVar">v</span> is a root.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._plai/collector..rkt)._heap-value~3f))"></a><span title="Provided from: plai/collector"><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._heap-value~3f))" class="RktValLink" pltdoc="x">heap-value?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="RktValLink" pltdoc="x">boolean?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">A value that may be stored on the heap. Roughly corresponds to the contract
<span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._or/c))" class="RktValLink" pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="../reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="RktValLink" pltdoc="x">boolean?</a></span><span class="stt"> </span><span class="RktSym"><a href="../reference/number-types.html#(def._((quote._~23~25kernel)._number~3f))" class="RktValLink" pltdoc="x">number?</a></span><span class="stt"> </span><span class="RktSym"><a href="../reference/procedures.html#(def._((quote._~23~25kernel)._procedure~3f))" class="RktValLink" pltdoc="x">procedure?</a></span><span class="stt"> </span><span class="RktSym"><a href="../reference/symbols.html#(def._((quote._~23~25kernel)._symbol~3f))" class="RktValLink" pltdoc="x">symbol?</a></span><span class="stt"> </span><span class="RktSym"><a href="../reference/pairs.html#(def._((lib._racket/list..rkt)._empty~3f))" class="RktValLink" pltdoc="x">empty?</a></span><span class="RktPn">)</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._plai/collector..rkt)._heap-set!))"></a><span title="Provided from: plai/collector"><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._heap-set!))" class="RktValLink" pltdoc="x">heap-set!</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">loc</span><span class="hspace">&nbsp;</span><span class="RktVar">val</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#(def._((quote._~23~25kernel)._void~3f))" class="RktValLink" pltdoc="x">void?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">loc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._location~3f))" class="RktValLink" pltdoc="x">location?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">val</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._heap-value~3f))" class="RktValLink" pltdoc="x">heap-value?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Sets the value at <span class="RktVar">loc</span> to <span class="RktVar">val</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._plai/collector..rkt)._heap-ref))"></a><span title="Provided from: plai/collector"><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._heap-ref))" class="RktValLink" pltdoc="x">heap-ref</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">loc</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._heap-value~3f))" class="RktValLink" pltdoc="x">heap-value?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">loc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._location~3f))" class="RktValLink" pltdoc="x">location?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns the value at <span class="RktVar">loc</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(form._((lib._plai/collector..rkt)._get-root-set))"></a><span title="Provided from: plai/collector"><span class="RktSym"><a href="#(form._((lib._plai/collector..rkt)._get-root-set))" class="RktStxLink" pltdoc="x">get-root-set</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">id</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Returns the current roots as a list.  Local roots are created for the
identifiers <span class="RktVar">id</span> as well.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._plai/collector..rkt)._read-root))"></a><span title="Provided from: plai/collector"><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._read-root))" class="RktValLink" pltdoc="x">read-root</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">root</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._location~3f))" class="RktValLink" pltdoc="x">location?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">root</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._root~3f))" class="RktValLink" pltdoc="x">root?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns the location of <span class="RktVar">root</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._plai/collector..rkt)._set-root!))"></a><span title="Provided from: plai/collector"><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._set-root!))" class="RktValLink" pltdoc="x">set-root!</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">root</span><span class="hspace">&nbsp;</span><span class="RktVar">loc</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#(def._((quote._~23~25kernel)._void~3f))" class="RktValLink" pltdoc="x">void?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">root</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._root~3f))" class="RktValLink" pltdoc="x">root?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">loc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._location~3f))" class="RktValLink" pltdoc="x">location?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Updates the root to reference the given location.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._plai/collector..rkt)._procedure-roots))"></a><span title="Provided from: plai/collector"><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._procedure-roots))" class="RktValLink" pltdoc="x">procedure-roots</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">proc</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._listof))" class="RktValLink" pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._root~3f))" class="RktValLink" pltdoc="x">root?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">proc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/procedures.html#(def._((quote._~23~25kernel)._procedure~3f))" class="RktValLink" pltdoc="x">procedure?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Given a closure stored on the heap, returns a list of the roots reachable
from the closure&rsquo;s environment.  If <span class="RktVar">proc</span> is not reachable, the
empty list is returned.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(form._((lib._plai/collector..rkt)._with-heap))"></a><span title="Provided from: plai/collector"><span class="RktSym"><a href="#(form._((lib._plai/collector..rkt)._with-heap))" class="RktStxLink" pltdoc="x">with-heap</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">heap</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">heap</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#(def._((lib._racket/contract/private/vector..rkt)._vectorof))" class="RktValLink" pltdoc="x">vectorof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._heap-value~3f))" class="RktValLink" pltdoc="x">heap-value?</a></span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Evaluates <span class="RktPn">(</span><span class="RktSym"><a href="../reference/begin.html#(form._((quote._~23~25kernel)._begin))" class="RktStxLink" pltdoc="x">begin</a></span><span class="stt"> </span><span class="RktVar">expr</span><span class="stt"> </span><span class="RktMeta"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span> in the context of <span class="RktVar">heap</span>. Useful in
tests:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="plai-scheme.html#(form._((lib._plai/main..rkt)._test))" class="RktStxLink" pltdoc="x">test</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._plai/collector..rkt)._with-heap))" class="RktStxLink" pltdoc="x">with-heap</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/vectors.html#(def._((quote._~23~25kernel)._make-vector))" class="RktValLink" pltdoc="x">make-vector</a></span><span class="hspace">&nbsp;</span><span class="RktVal">20</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._plai/scribblings/fake-collector..rkt)._init-allocator))" class="RktValLink" pltdoc="x">init-allocator</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3aderef))" class="RktValLink" pltdoc="x">gc:deref</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3aalloc-flat))" class="RktValLink" pltdoc="x">gc:alloc-flat</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><h4>2.2<tt>&nbsp;</tt><a name="(part._.Garbage_.Collector_.Exports)"></a>Garbage Collector Exports</h4><p>A garbage collector must define the following functions:</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._plai/scribblings/fake-collector..rkt)._init-allocator))"></a><span class="RktSym"><a href="#(def._((lib._plai/scribblings/fake-collector..rkt)._init-allocator))" class="RktValLink" pltdoc="x">init-allocator</a></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#(def._((quote._~23~25kernel)._void~3f))" class="RktValLink" pltdoc="x">void?</a></span></td></tr></table></blockquote></div><div class="SIntrapara"><span class="RktSym"><a href="#(def._((lib._plai/scribblings/fake-collector..rkt)._init-allocator))" class="RktValLink" pltdoc="x">init-allocator</a></span> is called before all other procedures by a
mutator. Place any requisite initialization code here.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3aderef))"></a><span class="RktSym"><a href="#(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3aderef))" class="RktValLink" pltdoc="x">gc:deref</a></span><span class="hspace">&nbsp;</span><span class="RktVar">loc</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._heap-value~3f))" class="RktValLink" pltdoc="x">heap-value?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">loc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._location~3f))" class="RktValLink" pltdoc="x">location?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Given the location of a flat Scheme value, this procedure should return that
value.  If the location does not hold a flat value, this function should signal
an error.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3aalloc-flat))"></a><span class="RktSym"><a href="#(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3aalloc-flat))" class="RktValLink" pltdoc="x">gc:alloc-flat</a></span><span class="hspace">&nbsp;</span><span class="RktVar">val</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._location~3f))" class="RktValLink" pltdoc="x">location?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">val</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._heap-value~3f))" class="RktValLink" pltdoc="x">heap-value?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">This procedure should allocate a flat Scheme value (number, symbol, boolean,
closure or empty list) on the heap, returning its location (a number). The
value should occupy a single heap cell, though you may use additional space to
store a tag, etc. You are also welcome to pre-allocate common constants (e.g.,
the empty list). This procedure may need to perform a garbage-collection. If
there is still insufficient space, it should signal an error.</div></p><p>Note that closures are flat values. The environment of a closure is internally
managed, but contains references to values on the heap. Therefore, during
garbage collection, the environment of reachable closures must be updated. The
language exposes the environment via the <span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._procedure-roots))" class="RktValLink" pltdoc="x">procedure-roots</a></span> function.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3acons))"></a><span class="RktSym"><a href="#(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3acons))" class="RktValLink" pltdoc="x">gc:cons</a></span><span class="hspace">&nbsp;</span><span class="RktVar">first</span><span class="hspace">&nbsp;</span><span class="RktVar">rest</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._location~3f))" class="RktValLink" pltdoc="x">location?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">first</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._location~3f))" class="RktValLink" pltdoc="x">location?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">rest</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._location~3f))" class="RktValLink" pltdoc="x">location?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Given the location of the <span class="RktVar">first</span> and <span class="RktVar">rest</span> values, this
procedure must allocate a cons cell on the heap.  If there is insufficient
space to allocate the cons cell, it should signal an error.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3afirst))"></a><span class="RktSym"><a href="#(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3afirst))" class="RktValLink" pltdoc="x">gc:first</a></span><span class="hspace">&nbsp;</span><span class="RktVar">cons-cell</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._location~3f))" class="RktValLink" pltdoc="x">location?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cons-cell</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._location~3f))" class="RktValLink" pltdoc="x">location?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">If the given location refers to a cons cell, this should return the first
field. Otherwise, it should signal an error.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3arest))"></a><span class="RktSym"><a href="#(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3arest))" class="RktValLink" pltdoc="x">gc:rest</a></span><span class="hspace">&nbsp;</span><span class="RktVar">cons-cell</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._location~3f))" class="RktValLink" pltdoc="x">location?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cons-cell</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._location~3f))" class="RktValLink" pltdoc="x">location?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">If the given location refers to a cons cell, this should return the rest
field. Otherwise, it should signal an error.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3aset-first!))"></a><span class="RktSym"><a href="#(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3aset-first!))" class="RktValLink" pltdoc="x">gc:set-first!</a></span><span class="hspace">&nbsp;</span><span class="RktVar">cons-cell</span><span class="hspace">&nbsp;</span><span class="RktVar">first-value</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#(def._((quote._~23~25kernel)._void~3f))" class="RktValLink" pltdoc="x">void?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cons-cell</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._location~3f))" class="RktValLink" pltdoc="x">location?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">first-value</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._location~3f))" class="RktValLink" pltdoc="x">location?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">If <span class="RktVar">cons-cell</span> refers to a cons cell, set the head of the cons cell to
<span class="RktVar">first-value</span>.  Otherwise, signal an error.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3aset-rest!))"></a><span class="RktSym"><a href="#(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3aset-rest!))" class="RktValLink" pltdoc="x">gc:set-rest!</a></span><span class="hspace">&nbsp;</span><span class="RktVar">cons-cell</span><span class="hspace">&nbsp;</span><span class="RktVar">rest-value</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#(def._((quote._~23~25kernel)._void~3f))" class="RktValLink" pltdoc="x">void?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cons-cell</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._location~3f))" class="RktValLink" pltdoc="x">location?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">rest-value</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._location~3f))" class="RktValLink" pltdoc="x">location?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">If <span class="RktVar">cons-cell</span> refers to a cons cell, set the tail of the cons cell to
<span class="RktVar">rest-value</span>.  Otherwise, signal an error.</div></p><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3acons~3f))"></a><span class="RktSym"><a href="#(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3acons~3f))" class="RktValLink" pltdoc="x">gc:cons?</a></span><span class="hspace">&nbsp;</span><span class="RktVar">loc</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="RktValLink" pltdoc="x">boolean?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">loc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._location~3f))" class="RktValLink" pltdoc="x">location?</a></span></td></tr></table></blockquote><p>Returns <span class="RktSym"><a href="../reference/booleans.html#(def._((lib._racket/bool..rkt)._true))" class="RktValLink" pltdoc="x">true</a></span> if <span class="RktVar">loc</span> refers to a cons cell.  This function
should never signal an error.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><a name="(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3aflat~3f))"></a><span class="RktSym"><a href="#(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3aflat~3f))" class="RktValLink" pltdoc="x">gc:flat?</a></span><span class="hspace">&nbsp;</span><span class="RktVar">loc</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="RktValLink" pltdoc="x">boolean?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">loc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._plai/collector..rkt)._location~3f))" class="RktValLink" pltdoc="x">location?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns <span class="RktSym"><a href="../reference/booleans.html#(def._((lib._racket/bool..rkt)._true))" class="RktValLink" pltdoc="x">true</a></span> if <span class="RktVar">loc</span> refers to a flat value.  This function
should never signal an error.</div></p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.2.1&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.2.1&quot;);">top</a></span><span class="navright"><a href="plai-scheme.html" title="backward to &quot;1 PLAI Scheme&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Programming Languages: Application and Interpretation&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<a href="mutator.html" title="forward to &quot;3 GC Mutator Scheme&quot;" pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>