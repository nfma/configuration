<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text-html; charset=utf-8" /><title>18&nbsp;Performance</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default" /><link rel="stylesheet" type="text/css" href="../racket.css" title="default" /><link rel="stylesheet" type="text/css" href="../scribble-style.css" title="default" /><script type="text/javascript" src="../scribble-common.js"></script></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist" style="margin-bottom: 1em;"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" pltdoc="x"><span style="font-weight: bold">The Racket Guide</span></a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="intro.html" class="tocviewlink" pltdoc="x">Welcome to Racket</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="to-scheme.html" class="tocviewlink" pltdoc="x">Racket Essentials</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="datatypes.html" class="tocviewlink" pltdoc="x">Built-<wbr></wbr>In Datatypes</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="scheme-forms.html" class="tocviewlink" pltdoc="x">Expressions and Definitions</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="define-struct.html" class="tocviewlink" pltdoc="x">Programmer-<wbr></wbr>Defined Datatypes</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="modules.html" class="tocviewlink" pltdoc="x">Modules</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="contracts.html" class="tocviewlink" pltdoc="x">Contracts</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="i_o.html" class="tocviewlink" pltdoc="x">Input and Output</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="regexp.html" class="tocviewlink" pltdoc="x">Regular Expressions</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="control.html" class="tocviewlink" pltdoc="x">Exceptions and Control</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="for.html" class="tocviewlink" pltdoc="x">Iterations and Comprehensions</a></td></tr><tr><td align="right">12&nbsp;</td><td><a href="match.html" class="tocviewlink" pltdoc="x">Pattern Matching</a></td></tr><tr><td align="right">13&nbsp;</td><td><a href="classes.html" class="tocviewlink" pltdoc="x">Classes and Objects</a></td></tr><tr><td align="right">14&nbsp;</td><td><a href="units.html" class="tocviewlink" pltdoc="x">Units (Components)</a></td></tr><tr><td align="right">15&nbsp;</td><td><a href="reflection.html" class="tocviewlink" pltdoc="x">Reflection and Dynamic Evaluation</a></td></tr><tr><td align="right">16&nbsp;</td><td><a href="macros.html" class="tocviewlink" pltdoc="x">Macros</a></td></tr><tr><td align="right">17&nbsp;</td><td><a href="languages.html" class="tocviewlink" pltdoc="x">Creating Languages</a></td></tr><tr><td align="right">18&nbsp;</td><td><a href="" class="tocviewselflink" pltdoc="x">Performance</a></td></tr><tr><td align="right">19&nbsp;</td><td><a href="running.html" class="tocviewlink" pltdoc="x">Running and Creating Executables</a></td></tr><tr><td align="right">20&nbsp;</td><td><a href="More_Libraries.html" class="tocviewlink" pltdoc="x">More Libraries</a></td></tr><tr><td align="right">21&nbsp;</td><td><a href="dialects.html" class="tocviewlink" pltdoc="x">Dialects of Racket and Scheme</a></td></tr><tr><td align="right">22&nbsp;</td><td><a href="other-editors.html" class="tocviewlink" pltdoc="x">Command-<wbr></wbr>Line Tools and Your Editor of Choice</a></td></tr><tr><td align="right"></td><td><a href="doc-bibliography.html" class="tocviewlink" pltdoc="x">Bibliography</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>18&nbsp;</td><td><a href="" class="tocviewselflink" pltdoc="x">Performance</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">18.1&nbsp;</td><td><a href="#(part._.Dr.Racket-perf)" class="tocviewlink" pltdoc="x">Performance in Dr<span class="mywbr"> </span>Racket</a></td></tr><tr><td align="right">18.2&nbsp;</td><td><a href="#(part._.J.I.T)" class="tocviewlink" pltdoc="x">The Bytecode and Just-<wbr></wbr>in-<wbr></wbr>Time (JIT) Compilers</a></td></tr><tr><td align="right">18.3&nbsp;</td><td><a href="#(part._modules-performance)" class="tocviewlink" pltdoc="x">Modules and Performance</a></td></tr><tr><td align="right">18.4&nbsp;</td><td><a href="#(part._func-call-performance)" class="tocviewlink" pltdoc="x">Function-<wbr></wbr>Call Optimizations</a></td></tr><tr><td align="right">18.5&nbsp;</td><td><a href="#(part._.Mutation_and_.Performance)" class="tocviewlink" pltdoc="x">Mutation and Performance</a></td></tr><tr><td align="right">18.6&nbsp;</td><td><a href="#(part._letrec-performance)" class="tocviewlink" pltdoc="x"><span class="RktSym"><span class="RktStxLink">letrec</span></span> Performance</a></td></tr><tr><td align="right">18.7&nbsp;</td><td><a href="#(part._fixnums+flonums)" class="tocviewlink" pltdoc="x">Fixnum and Flonum Optimizations</a></td></tr><tr><td align="right">18.8&nbsp;</td><td><a href="#(part._unchecked-unsafe)" class="tocviewlink" pltdoc="x">Unchecked, Unsafe Operations</a></td></tr><tr><td align="right">18.9&nbsp;</td><td><a href="#(part._gc-perf)" class="tocviewlink" pltdoc="x">Memory Management</a></td></tr><tr><td align="right">18.10&nbsp;</td><td><a href="#(part._effective-futures)" class="tocviewlink" pltdoc="x">Parallelism with Futures</a></td></tr><tr><td align="right">18.11&nbsp;</td><td><a href="#(part._effective-places)" class="tocviewlink" pltdoc="x">Parallelism with Places</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">18.1<tt>&nbsp;</tt></span><a href="#(part._.Dr.Racket-perf)" class="tocsubseclink" pltdoc="x">Performance in Dr<span class="mywbr"> </span>Racket</a></td></tr><tr><td><span class="tocsublinknumber">18.2<tt>&nbsp;</tt></span><a href="#(part._.J.I.T)" class="tocsubseclink" pltdoc="x">The Bytecode and Just-<wbr></wbr>in-<wbr></wbr>Time (JIT) Compilers</a></td></tr><tr><td><span class="tocsublinknumber">18.3<tt>&nbsp;</tt></span><a href="#(part._modules-performance)" class="tocsubseclink" pltdoc="x">Modules and Performance</a></td></tr><tr><td><span class="tocsublinknumber">18.4<tt>&nbsp;</tt></span><a href="#(part._func-call-performance)" class="tocsubseclink" pltdoc="x">Function-<wbr></wbr>Call Optimizations</a></td></tr><tr><td><span class="tocsublinknumber">18.5<tt>&nbsp;</tt></span><a href="#(part._.Mutation_and_.Performance)" class="tocsubseclink" pltdoc="x">Mutation and Performance</a></td></tr><tr><td><span class="tocsublinknumber">18.6<tt>&nbsp;</tt></span><a href="#(part._letrec-performance)" class="tocsubseclink" pltdoc="x"><span class="RktSym"><span class="RktStxLink">letrec</span></span> Performance</a></td></tr><tr><td><span class="tocsublinknumber">18.7<tt>&nbsp;</tt></span><a href="#(part._fixnums+flonums)" class="tocsubseclink" pltdoc="x">Fixnum and Flonum Optimizations</a></td></tr><tr><td><span class="tocsublinknumber">18.8<tt>&nbsp;</tt></span><a href="#(part._unchecked-unsafe)" class="tocsubseclink" pltdoc="x">Unchecked, Unsafe Operations</a></td></tr><tr><td><span class="tocsublinknumber">18.9<tt>&nbsp;</tt></span><a href="#(part._gc-perf)" class="tocsubseclink" pltdoc="x">Memory Management</a></td></tr><tr><td><span class="tocsublinknumber">18.10<tt>&nbsp;</tt></span><a href="#(part._effective-futures)" class="tocsubseclink" pltdoc="x">Parallelism with Futures</a></td></tr><tr><td><span class="tocsublinknumber">18.11<tt>&nbsp;</tt></span><a href="#(part._effective-places)" class="tocsubseclink" pltdoc="x">Parallelism with Places</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.2.1&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.2.1&quot;);">top</a></span><span class="navright"><a href="module-runtime-config.html" title="backward to &quot;17.3.6 Module-Handling Configuration&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;The Racket Guide&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<a href="running.html" title="forward to &quot;19 Running and Creating Executables&quot;" pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3>18<tt>&nbsp;</tt><a name="(part._performance)"></a><a name="(idx._(gentag._4._(lib._scribblings/guide/guide..scrbl)))"></a><a name="(idx._(gentag._5._(lib._scribblings/guide/guide..scrbl)))"></a>Performance</h3><p>Alan Perlis famously quipped &ldquo;Lisp programmers know the value of
everything and the cost of nothing.&rdquo; A Racket programmer knows, for
example, that a <span class="RktSym"><a href="../reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="RktStxLink" pltdoc="x">lambda</a></span> anywhere in a program produces a value
that is closed over its lexical environment&#8212;<wbr></wbr>but how much does
allocating that value cost? While most programmers have a reasonable
grasp of the cost of various operations and data structures at the
machine level, the gap between the Racket language model and the
underlying computing machinery can be quite large.</p><p>In this chapter, we narrow the gap by explaining details of the
Racket compiler and run-time system and how they affect the run-time
and memory performance of Racket code.</p><h4>18.1<tt>&nbsp;</tt><a name="(part._.Dr.Racket-perf)"></a>Performance in DrRacket</h4><p>By default, DrRacket instruments programs for debugging, and
debugging instrumentation can significantly degrade performance for
some programs. Even when debugging is disabled through the
<span style="font-family: sans-serif; font-size: 80%; font-weight: bold">Choose Language...</span> dialog&rsquo;s <span style="font-family: sans-serif; font-size: 80%; font-weight: bold">Show Details</span> panel,
the <span style="font-family: sans-serif; font-size: 80%; font-weight: bold">Preserve stacktrace</span> checkbox is clicked by default,
which also affects performance. Disabling debugging and stacktrace
preservation provides performance results that are more consistent
with running in plain <span class="stt">racket</span>.</p><p>Even so, DrRacket and programs developed within DrRacket use the same
Racket virtual machine, so garbage collection times (see
<a href="#(part._gc-perf)" pltdoc="x">Memory Management</a>) may be longer in DrRacket than when a program is
run by itself, and DrRacket threads may impede execution of program
threads. For the most reliable timing results for a program, run in
plain <span class="stt">racket</span> instead of in the DrRacket development environment.
Non-interactive mode should be used instead of the
<a href="intro.html#(tech._repl)" class="techoutside" pltdoc="x"><span class="techinside">REPL</span></a> to benefit from the module system. See
<a href="#(part._modules-performance)" pltdoc="x">Modules and Performance</a> for details.</p><h4>18.2<tt>&nbsp;</tt><a name="(part._.J.I.T)"></a>The Bytecode and Just-in-Time (JIT) Compilers</h4><p>Every definition or expression to be evaluated by Racket is compiled
to an internal bytecode format. In interactive mode, this compilation
occurs automatically and on-the-fly. Tools like <span class="stt">raco make</span> and
<span class="stt">raco setup</span> marshal compiled bytecode to a file, so that you do
not have to compile from source every time that you run a
program. (Most of the time required to compile a file is actually in
macro expansion; generating bytecode from fully expanded code is
relatively fast.) See <a href="cmdline-tools.html#(part._compile)" pltdoc="x">Compilation and Configuration: <span class="stt">raco</span></a> for more information on
generating bytecode files.</p><p>The bytecode compiler applies all standard optimizations, such as
constant propagation, constant folding, inlining, and dead-code
elimination. For example, in an environment where <span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span> has its
usual binding, the expression <span class="RktPn">(</span><span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktPn">]</span><span class="stt"> </span><span class="RktPn">[</span><span class="RktSym">y</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="RktStxLink" pltdoc="x">lambda</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktVal">4</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span> is compiled the same as the constant <span class="RktVal">5</span>.</p><p>On some platforms, bytecode is further compiled to native code via a
<a name="(tech._just._in._time)"></a><span style="font-style: italic">just-in-time</span> or <a name="(tech._jit)"></a><span style="font-style: italic">JIT</span> compiler. The <a href="#(tech._jit)" class="techoutside" pltdoc="x"><span class="techinside">JIT</span></a>
compiler substantially speeds programs that execute tight loops,
arithmetic on small integers, and arithmetic on inexact real
numbers. Currently, <a href="#(tech._jit)" class="techoutside" pltdoc="x"><span class="techinside">JIT</span></a> compilation is supported for x86,
x86_64 (a.k.a. AMD64), and 32-bit PowerPC processors. The <a href="#(tech._jit)" class="techoutside" pltdoc="x"><span class="techinside">JIT</span></a>
compiler can be disabled via the <span class="RktSym"><a href="../reference/eval.html#(def._((quote._~23~25kernel)._eval-jit-enabled))" class="RktValLink" pltdoc="x">eval-jit-enabled</a></span> parameter
or the <span class="nobreak"><span class="stt">--no-jit</span></span>/<span class="nobreak"><span class="stt">-j</span></span> command-line flag for <span class="stt">racket</span>.</p><p>The <a href="#(tech._jit)" class="techoutside" pltdoc="x"><span class="techinside">JIT</span></a> compiler works incrementally as functions are applied,
but the <a href="#(tech._jit)" class="techoutside" pltdoc="x"><span class="techinside">JIT</span></a> compiler makes only limited use of run-time
information when compiling procedures, since the code for a given
module body or <span class="RktSym"><a href="../reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="RktStxLink" pltdoc="x">lambda</a></span> abstraction is compiled only once. The
<a href="#(tech._jit)" class="techoutside" pltdoc="x"><span class="techinside">JIT</span></a>&rsquo;s granularity of compilation is a single procedure body,
not counting the bodies of any lexically nested procedures. The
overhead for <a href="#(tech._jit)" class="techoutside" pltdoc="x"><span class="techinside">JIT</span></a> compilation is normally so small that it is
difficult to detect.</p><h4>18.3<tt>&nbsp;</tt><a name="(part._modules-performance)"></a>Modules and Performance</h4><p>The module system aids optimization by helping to ensure that
identifiers have the usual bindings. That is, the <span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span> provided
by <a href="../reference/index.html" class="RktModLink" pltdoc="x"><span class="RktSym">racket/base</span></a> can be recognized by the compiler and
inlined, which is especially important for <a href="#(tech._jit)" class="techoutside" pltdoc="x"><span class="techinside">JIT</span></a>-compiled code.
In contrast, in a traditional interactive Scheme system, the top-level
<span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span> binding might be redefined, so the compiler cannot assume a
fixed <span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span> binding (unless special flags or declarations
are used to compensate for the lack of a module system).</p><p>Even in the top-level environment, importing with <span class="RktSym"><a href="../reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="RktStxLink" pltdoc="x">require</a></span>
enables some inlining optimizations. Although a <span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span> definition
at the top level might shadow an imported <span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span>, the shadowing
definition applies only to expressions evaluated later.</p><p>Within a module, inlining and constant-propagation optimizations take
additional advantage of the fact that definitions within a module
cannot be mutated when no <span class="RktSym"><a href="../reference/set_.html#(form._((quote._~23~25kernel)._set!))" class="RktStxLink" pltdoc="x">set!</a></span> is visible at compile
time. Such optimizations are unavailable in the top-level
environment. Although this optimization within modules is important
for performance, it hinders some forms of interactive development and
exploration. The <span class="RktSym"><a href="../reference/eval.html#(def._((quote._~23~25kernel)._compile-enforce-module-constants))" class="RktValLink" pltdoc="x">compile-enforce-module-constants</a></span> parameter
disables the <a href="#(tech._jit)" class="techoutside" pltdoc="x"><span class="techinside">JIT</span></a> compiler&rsquo;s assumptions about module
definitions when interactive exploration is more important. See
<a href="module-set.html" pltdoc="x">Assignment and Redefinition</a> for more information.</p><p>The compiler may inline functions or propagate constants across module
boundaries. To avoid generating too much code in the case of function
inlining, the compiler is conservative when choosing candidates for
cross-module inlining; see <a href="#(part._func-call-performance)" pltdoc="x">Function-Call Optimizations</a> for
information on providing inlining hints to the compiler.</p><p>The later section <a href="#(part._letrec-performance)" pltdoc="x"><span class="RktSym"><span class="RktStxLink">letrec</span></span> Performance</a> provides some
additional caveats concerning inlining of module bindings.</p><h4>18.4<tt>&nbsp;</tt><a name="(part._func-call-performance)"></a>Function-Call Optimizations</h4><p>When the compiler detects a function call to an immediately visible
function, it generates more efficient code than for a generic call,
especially for tail calls. For example, given the program</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._letrec))" class="RktStxLink" pltdoc="x">letrec</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">odd</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="RktStxLink" pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/if.html#(form._((quote._~23~25kernel)._if))" class="RktStxLink" pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/number-types.html#(def._((quote._~23~25kernel)._zero~3f))" class="RktValLink" pltdoc="x">zero?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">even</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._sub1))" class="RktValLink" pltdoc="x">sub1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">even</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="RktStxLink" pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/if.html#(form._((quote._~23~25kernel)._if))" class="RktStxLink" pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/number-types.html#(def._((quote._~23~25kernel)._zero~3f))" class="RktValLink" pltdoc="x">zero?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#t</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">odd</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._sub1))" class="RktValLink" pltdoc="x">sub1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">odd</span><span class="hspace">&nbsp;</span><span class="RktVal">40000000</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>the compiler can detect the <span class="RktSym">odd</span>&ndash;<span class="RktSym">even</span> loop and
produce code that runs much faster via loop unrolling and related
optimizations.</p><p>Within a module form, <span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span>d variables are lexically scoped
like <span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._letrec))" class="RktStxLink" pltdoc="x">letrec</a></span> bindings, and definitions within a module
therefore permit call optimizations, so</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">odd</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">....</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">even</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">....</span><span class="RktPn">)</span></td></tr></table></blockquote><p>within a module would perform the same as the <span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._letrec))" class="RktStxLink" pltdoc="x">letrec</a></span> version.</p><p>For direct calls to functions with keyword arguments, the compiler can
typically check keyword arguments statically and generate a direct
call to a non-keyword variant of the function, which reduces the
run-time overhead of keyword checking. This optimization applies only
for keyword-accepting procedures that are bound with <span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span>.</p><p>For immediate calls to functions that are small enough, the compiler
may inline the function call by replacing the call with the body of
the function. In addition to the size of the target function&rsquo;s body,
the compiler&rsquo;s heuristics take into account the amount of inlining
already performed at the call site and whether the called function
itself calls functions other than simple primitive operations. When a
module is compiled, some functions defined at the module level are
determined to be candidates for inlining into other modules; normally,
only trivial functions are considered candidates for cross-module
inlining, but a programmer can wrap a function definition with
<span class="RktSym"><a href="../reference/performance-hint.html#(form._((lib._racket/performance-hint..rkt)._begin-encourage-inline))" class="RktStxLink" pltdoc="x">begin-encourage-inline</a></span> to encourage inlining
of the function.</p><p>Primitive operations like <span class="RktSym"><a href="../reference/pairs.html#(def._((quote._~23~25kernel)._pair~3f))" class="RktValLink" pltdoc="x">pair?</a></span>, <span class="RktSym"><a href="../reference/pairs.html#(def._((quote._~23~25kernel)._car))" class="RktValLink" pltdoc="x">car</a></span>, and
<span class="RktSym"><a href="../reference/pairs.html#(def._((quote._~23~25kernel)._cdr))" class="RktValLink" pltdoc="x">cdr</a></span> are inlined at the machine-code level by the <a href="#(tech._jit)" class="techoutside" pltdoc="x"><span class="techinside">JIT</span></a>
compiler. See also the later section <a href="#(part._fixnums+flonums)" pltdoc="x">Fixnum and Flonum Optimizations</a> for
information about inlined arithmetic operations.</p><h4>18.5<tt>&nbsp;</tt><a name="(part._.Mutation_and_.Performance)"></a>Mutation and Performance</h4><p>Using <span class="RktSym"><a href="../reference/set_.html#(form._((quote._~23~25kernel)._set!))" class="RktStxLink" pltdoc="x">set!</a></span> to mutate a variable can lead to bad
performance. For example, the microbenchmark</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><a href="Module_Syntax.html#(part._hash-lang)" class="RktModLink" pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="../reference/index.html" class="RktModLink" pltdoc="x"><span class="RktSym">racket/base</span></a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subtract-one</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/set_.html#(form._((quote._~23~25kernel)._set!))" class="RktStxLink" pltdoc="x">set!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._sub1))" class="RktValLink" pltdoc="x">sub1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/time.html#(form._((lib._racket/private/more-scheme..rkt)._time))" class="RktStxLink" pltdoc="x">time</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">4000000</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/if.html#(form._((quote._~23~25kernel)._if))" class="RktStxLink" pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/number-types.html#(def._((quote._~23~25kernel)._zero~3f))" class="RktValLink" pltdoc="x">zero?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">done</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subtract-one</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>runs much more slowly than the equivalent</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><a href="Module_Syntax.html#(part._hash-lang)" class="RktModLink" pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="../reference/index.html" class="RktModLink" pltdoc="x"><span class="RktSym">racket/base</span></a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subtract-one</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._sub1))" class="RktValLink" pltdoc="x">sub1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/time.html#(form._((lib._racket/private/more-scheme..rkt)._time))" class="RktStxLink" pltdoc="x">time</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">4000000</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/if.html#(form._((quote._~23~25kernel)._if))" class="RktStxLink" pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/number-types.html#(def._((quote._~23~25kernel)._zero~3f))" class="RktValLink" pltdoc="x">zero?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">done</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subtract-one</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>In the first variant, a new location is allocated for <span class="RktSym">x</span> on
every iteration, leading to poor performance. A more clever compiler
could unravel the use of <span class="RktSym"><a href="../reference/set_.html#(form._((quote._~23~25kernel)._set!))" class="RktStxLink" pltdoc="x">set!</a></span> in the first example, but since
mutation is discouraged (see <a href="set_.html#(part._using-set!)" pltdoc="x">Guidelines for Using Assignment</a>), the compiler&rsquo;s
effort is spent elsewhere.</p><p>More significantly, mutation can obscure bindings where inlining and
constant-propagation might otherwise apply. For example, in</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">minus1</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/set_.html#(form._((quote._~23~25kernel)._set!))" class="RktStxLink" pltdoc="x">set!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">minus1</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._sub1))" class="RktValLink" pltdoc="x">sub1</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">4000000</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/if.html#(form._((quote._~23~25kernel)._if))" class="RktStxLink" pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/number-types.html#(def._((quote._~23~25kernel)._zero~3f))" class="RktValLink" pltdoc="x">zero?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">done</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">minus1</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>the <span class="RktSym"><a href="../reference/set_.html#(form._((quote._~23~25kernel)._set!))" class="RktStxLink" pltdoc="x">set!</a></span> obscures the fact that <span class="RktSym">minus1</span> is just
another name for the built-in <span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._sub1))" class="RktValLink" pltdoc="x">sub1</a></span>.</p><h4>18.6<tt>&nbsp;</tt><a name="(part._letrec-performance)"></a><span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._letrec))" class="RktStxLink" pltdoc="x">letrec</a></span> Performance</h4><p>When <span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._letrec))" class="RktStxLink" pltdoc="x">letrec</a></span> is used to bind only procedures and literals,
then the compiler can treat the bindings in an optimal manner,
compiling uses of the bindings efficiently. When other kinds of
bindings are mixed with procedures, the compiler may be less able to
determine the control flow.</p><p>For example,</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._letrec))" class="RktStxLink" pltdoc="x">letrec</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="RktStxLink" pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/if.html#(form._((quote._~23~25kernel)._if))" class="RktStxLink" pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/number-types.html#(def._((quote._~23~25kernel)._zero~3f))" class="RktValLink" pltdoc="x">zero?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">done</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">next</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">junk</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Writing.html#(def._((quote._~23~25kernel)._display))" class="RktValLink" pltdoc="x">display</a></span><span class="hspace">&nbsp;</span><span class="RktSym">loop</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">next</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="RktStxLink" pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._sub1))" class="RktValLink" pltdoc="x">sub1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktVal">40000000</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>likely compiles to less efficient code than</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._letrec))" class="RktStxLink" pltdoc="x">letrec</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="RktStxLink" pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/if.html#(form._((quote._~23~25kernel)._if))" class="RktStxLink" pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/number-types.html#(def._((quote._~23~25kernel)._zero~3f))" class="RktValLink" pltdoc="x">zero?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">done</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">next</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">next</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="RktStxLink" pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._sub1))" class="RktValLink" pltdoc="x">sub1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktVal">40000000</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>In the first case, the compiler likely does not know that
<span class="RktSym"><a href="../reference/Writing.html#(def._((quote._~23~25kernel)._display))" class="RktValLink" pltdoc="x">display</a></span> does not call <span class="RktSym">loop</span>. If it did, then
<span class="RktSym">loop</span> might refer to <span class="RktSym">next</span> before the binding is
available.</p><p>This caveat about <span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._letrec))" class="RktStxLink" pltdoc="x">letrec</a></span> also applies to definitions of
functions and constants as internal definitions or in modules. A
definition sequence in a module body is analogous to a sequence of
<span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._letrec))" class="RktStxLink" pltdoc="x">letrec</a></span> bindings, and non-constant expressions in a module
body can interfere with the optimization of references to later
bindings.</p><h4>18.7<tt>&nbsp;</tt><a name="(part._fixnums+flonums)"></a>Fixnum and Flonum Optimizations</h4><p>A <a name="(tech._fixnum)"></a><span style="font-style: italic">fixnum</span> is a small exact integer. In this case, &ldquo;small&rdquo;
depends on the platform. For a 32-bit machine, numbers that can be
expressed in 30 bits plus a sign bit are represented as fixnums. On a
64-bit machine, 62 bits plus a sign bit are available.</p><p>A <a name="(tech._flonum)"></a><span style="font-style: italic">flonum</span> is used to represent any inexact real number. They
correspond to 64-bit IEEE floating-point numbers on all platforms.</p><p>Inlined fixnum and flonum arithmetic operations are among the most
important advantages of the <a href="#(tech._jit)" class="techoutside" pltdoc="x"><span class="techinside">JIT</span></a> compiler. For example, when
<span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span> is applied to two arguments, the generated machine code
tests whether the two arguments are fixnums, and if so, it uses the
machine&rsquo;s instruction to add the numbers (and check for overflow). If
the two numbers are not fixnums, then it checks whether whether
both are flonums; in that case, the machine&rsquo;s floating-point
operations are used directly. For functions that take any number of
arguments, such as <span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span>, inlining works for two or more
arguments (except for <span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" class="RktValLink" pltdoc="x"><span class="nobreak">-</span></a></span>, whose one-argument case is also
inlined) when the arguments are either all fixnums or all flonums.</p><p>Flonums are typically <span style="font-style: italic">boxed</span>, which means that memory is
allocated to hold every result of a flonum computation. Fortunately,
the generational garbage collector (described later in
<a href="#(part._gc-perf)" pltdoc="x">Memory Management</a>) makes allocation for short-lived results
reasonably cheap. Fixnums, in contrast are never boxed, so they are
typically cheap to use.</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>See <a href="#(part._effective-futures)" pltdoc="x">Parallelism with Futures</a> for an example use of
<a href="#(tech._flonum)" class="techoutside" pltdoc="x"><span class="techinside">flonum</span></a>-specific operations.</p></blockquote></blockquote></blockquote><p>The <a href="../reference/flonums.html" class="RktModLink" pltdoc="x"><span class="RktSym">racket/flonum</span></a> library provides flonum-specific
operations, and combinations of flonum operations allow the <a href="#(tech._jit)" class="techoutside" pltdoc="x"><span class="techinside">JIT</span></a>
compiler to generate code that avoids boxing and unboxing intermediate
results. Besides results within immediate combinations,
flonum-specific results that are bound with <span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span> and consumed
by a later flonum-specific operation are unboxed within temporary
storage. Finally, the compiler can detect some flonum-valued loop
accumulators and avoid boxing of the accumulator. The bytecode
decompiler (see <a href="../raco/decompile.html" pltdoc="x"><span class="stt">raco decompile</span>: Decompiling Bytecode</a>) annotates combinations where the JIT can avoid boxes with
<span class="RktSym">#%flonum</span>, <span class="RktSym">#%as-flonum</span>, and
<span class="RktSym">#%from-flonum</span>.</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>Unboxing of local bindings and accumualtors is not
supported by the JIT for PowerPC.</p></blockquote></blockquote></blockquote><p>The <a href="../reference/unsafe.html" class="RktModLink" pltdoc="x"><span class="RktSym">racket/unsafe/ops</span></a> library provides unchecked
fixnum- and flonum-specific operations. Unchecked flonum-specific
operations allow unboxing, and sometimes they allow the compiler to
reorder expressions to improve performance. See also
<a href="#(part._unchecked-unsafe)" pltdoc="x">Unchecked, Unsafe Operations</a>, especially the warnings about unsafety.</p><h4>18.8<tt>&nbsp;</tt><a name="(part._unchecked-unsafe)"></a>Unchecked, Unsafe Operations</h4><p>The <a href="../reference/unsafe.html" class="RktModLink" pltdoc="x"><span class="RktSym">racket/unsafe/ops</span></a> library provides functions that
are like other functions in <a href="../reference/index.html" class="RktModLink" pltdoc="x"><span class="RktSym">racket/base</span></a>, but they
assume (instead of checking) that provided arguments are of the right
type. For example, <span class="RktSym"><a href="../reference/unsafe.html#(def._((lib._racket/unsafe/ops..rkt)._unsafe-vector-ref))" class="RktValLink" pltdoc="x">unsafe-vector-ref</a></span> accesses an element from
a vector without checking that its first argument is actually a vector
and without checking that the given index is in bounds. For tight
loops that use these functions, avoiding checks can sometimes speed
the computation, though the benefits vary for different unchecked
functions and different contexts.</p><p>Beware that, as &ldquo;unsafe&rdquo; in the library and function names suggest,
misusing the exports of <a href="../reference/unsafe.html" class="RktModLink" pltdoc="x"><span class="RktSym">racket/unsafe/ops</span></a> can lead to
crashes or memory corruption.</p><h4>18.9<tt>&nbsp;</tt><a name="(part._gc-perf)"></a>Memory Management</h4><p>The Racket implementation is available in two variants: <a name="(tech._3m)"></a><span style="font-style: italic">3m</span> and
<a name="(tech._cgc)"></a><span style="font-style: italic">CGC</span>. The <a href="#(tech._3m)" class="techoutside" pltdoc="x"><span class="techinside">3m</span></a> variant uses a modern,
<a name="(tech._generational._garbage._collector)"></a><span style="font-style: italic">generational garbage collector</span> that makes allocation
relatively cheap for short-lived objects. The <a href="#(tech._cgc)" class="techoutside" pltdoc="x"><span class="techinside">CGC</span></a> variant uses
a <a name="(tech._conservative._garbage._collector)"></a><span style="font-style: italic">conservative garbage collector</span> which facilitates
interaction with C code at the expense of both precision and speed for
Racket memory management. The 3m variant is the standard one.</p><p>Although memory allocation is reasonably cheap, avoiding allocation
altogether is normally faster. One particular place where allocation
can be avoided sometimes is in <a name="(tech._closure)"></a><span style="font-style: italic">closures</span>, which are the
run-time representation of functions that contain free variables.
For example,</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">40000000</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">prev-thunk</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="RktStxLink" pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/if.html#(form._((quote._~23~25kernel)._if))" class="RktStxLink" pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/number-types.html#(def._((quote._~23~25kernel)._zero~3f))" class="RktValLink" pltdoc="x">zero?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">prev-thunk</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._sub1))" class="RktValLink" pltdoc="x">sub1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="RktStxLink" pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>allocates a closure on every iteration, since <span class="RktPn">(</span><span class="RktSym"><a href="../reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="RktStxLink" pltdoc="x">lambda</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym">n</span><span class="RktPn">)</span>
effectively saves <span class="RktSym">n</span>.</p><p>The compiler can eliminate many closures automatically. For example,
in</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">40000000</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">prev-val</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">prev-thunk</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="RktStxLink" pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/if.html#(form._((quote._~23~25kernel)._if))" class="RktStxLink" pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/number-types.html#(def._((quote._~23~25kernel)._zero~3f))" class="RktValLink" pltdoc="x">zero?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">prev-val</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._sub1))" class="RktValLink" pltdoc="x">sub1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">prev-thunk</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>no closure is ever allocated for <span class="RktSym">prev-thunk</span>, because its only
application is visible, and so it is inlined. Similarly, in</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n-loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">400000</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/if.html#(form._((quote._~23~25kernel)._if))" class="RktStxLink" pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/number-types.html#(def._((quote._~23~25kernel)._zero~3f))" class="RktValLink" pltdoc="x">zero?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">done</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktSym">m-loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">m</span><span class="hspace">&nbsp;</span><span class="RktVal">100</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/if.html#(form._((quote._~23~25kernel)._if))" class="RktStxLink" pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/number-types.html#(def._((quote._~23~25kernel)._zero~3f))" class="RktValLink" pltdoc="x">zero?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">m</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n-loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._sub1))" class="RktValLink" pltdoc="x">sub1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">m-loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._sub1))" class="RktValLink" pltdoc="x">sub1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">m</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>then the expansion of the <span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span> form to implement
<span class="RktSym">m-loop</span> involves a closure over <span class="RktSym">n</span>, but the compiler
automatically converts the closure to pass itself <span class="RktSym">n</span> as an
argument instead.</p><h4>18.10<tt>&nbsp;</tt><a name="(part._effective-futures)"></a>Parallelism with Futures</h4><p>The <a href="../reference/futures.html" class="RktModLink" pltdoc="x"><span class="RktSym">racket/future</span></a> library provides support for
performance improvement through parallelism with the <span class="RktSym"><a href="../reference/futures.html#(def._((lib._racket/future..rkt)._future))" class="RktValLink" pltdoc="x">future</a></span>
and <span class="RktSym"><a href="../reference/futures.html#(def._((lib._racket/future..rkt)._touch))" class="RktValLink" pltdoc="x">touch</a></span> functions. The level of parallelism available from
those constructs, however, is limited by several factors, and the
current implementation is best suited to numerical tasks.</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>Other functions, such as <span class="RktSym"><a href="../reference/threads.html#(def._((quote._~23~25kernel)._thread))" class="RktValLink" pltdoc="x">thread</a></span>, support the
creation of reliably concurrent tasks. However, thread never run truly
in parallel, even if the hardware and operating system support
parallelism.</p></blockquote></blockquote></blockquote><p>As a starting example, the <span class="RktSym">any-double?</span> function below takes a
list of numbers and determines whether any number in the list has a
double that is also in the list:</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">any-double?</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/for.html#(form._((lib._racket/private/base..rkt)._for/or))" class="RktStxLink" pltdoc="x">for/or</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/sequences.html#(def._((lib._racket/private/base..rkt)._in-list))" class="RktValLink" pltdoc="x">in-list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/for.html#(form._((lib._racket/private/base..rkt)._for/or))" class="RktStxLink" pltdoc="x">for/or</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">i2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/sequences.html#(def._((lib._racket/private/base..rkt)._in-list))" class="RktValLink" pltdoc="x">in-list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3d))" class="RktValLink" pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">i2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="RktValLink" pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>This function runs in quadratic time, so it can take a long time (on
the order of a second) on large lists like <span class="RktSym">l1</span> and
<span class="RktSym">l2</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/for.html#(form._((lib._racket/private/base..rkt)._for/list))" class="RktStxLink" pltdoc="x">for/list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/sequences.html#(def._((lib._racket/private/base..rkt)._in-range))" class="RktValLink" pltdoc="x">in-range</a></span><span class="hspace">&nbsp;</span><span class="RktVal">5000</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="RktValLink" pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/for.html#(form._((lib._racket/private/base..rkt)._for/list))" class="RktStxLink" pltdoc="x">for/list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/sequences.html#(def._((lib._racket/private/base..rkt)._in-range))" class="RktValLink" pltdoc="x">in-range</a></span><span class="hspace">&nbsp;</span><span class="RktVal">5000</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" class="RktValLink" pltdoc="x"><span class="nobreak">-</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="RktValLink" pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._or))" class="RktStxLink" pltdoc="x">or</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">any-double?</span><span class="hspace">&nbsp;</span><span class="RktSym">l1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">any-double?</span><span class="hspace">&nbsp;</span><span class="RktSym">l2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>The best way to speed up <span class="RktSym">any-double?</span>  is to use a different
algorithm. However, on a machine that offers at least two processing
units, the example above can run in about half the time using
<span class="RktSym"><a href="../reference/futures.html#(def._((lib._racket/future..rkt)._future))" class="RktValLink" pltdoc="x">future</a></span> and <span class="RktSym"><a href="../reference/futures.html#(def._((lib._racket/future..rkt)._touch))" class="RktValLink" pltdoc="x">touch</a></span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">f</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/futures.html#(def._((lib._racket/future..rkt)._future))" class="RktValLink" pltdoc="x">future</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="RktStxLink" pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">any-double?</span><span class="hspace">&nbsp;</span><span class="RktSym">l2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._or))" class="RktStxLink" pltdoc="x">or</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">any-double?</span><span class="hspace">&nbsp;</span><span class="RktSym">l1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/futures.html#(def._((lib._racket/future..rkt)._touch))" class="RktValLink" pltdoc="x">touch</a></span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>The future <span class="RktSym">f</span> runs <span class="RktPn">(</span><span class="RktSym">any-double?</span><span class="stt"> </span><span class="RktSym">l2</span><span class="RktPn">)</span> in parallel to
<span class="RktPn">(</span><span class="RktSym">any-double?</span><span class="stt"> </span><span class="RktSym">l1</span><span class="RktPn">)</span>, and the result for <span class="RktPn">(</span><span class="RktSym">any-double?</span><span class="stt"> </span><span class="RktSym">l2</span><span class="RktPn">)</span> becomes available about the same time that it is demanded by
<span class="RktPn">(</span><span class="RktSym"><a href="../reference/futures.html#(def._((lib._racket/future..rkt)._touch))" class="RktValLink" pltdoc="x">touch</a></span><span class="stt"> </span><span class="RktSym">f</span><span class="RktPn">)</span>.</p><p>Futures run in parallel as long as they can do so safely, but the
notion of &ldquo;safe&rdquo; for parallelism is inherently tied to the system
implementation. The distinction between &ldquo;safe&rdquo; and &ldquo;unsafe&rdquo;
operations may be far from apparent at the level of a Racket program.</p><p>Consider the following core of a Mandelbrot-set computation:</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mandelbrot</span><span class="hspace">&nbsp;</span><span class="RktSym">iterations</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">ci</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" class="RktValLink" pltdoc="x"><span class="nobreak">-</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._/))" class="RktValLink" pltdoc="x">/</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="RktValLink" pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2.0</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1.0</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">cr</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" class="RktValLink" pltdoc="x"><span class="nobreak">-</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._/))" class="RktValLink" pltdoc="x">/</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="RktValLink" pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2.0</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1.5</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">zr</span><span class="hspace">&nbsp;</span><span class="RktVal">0.0</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">zi</span><span class="hspace">&nbsp;</span><span class="RktVal">0.0</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/if.html#(form._((quote._~23~25kernel)._if))" class="RktStxLink" pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3e))" class="RktValLink" pltdoc="x">&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktSym">iterations</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">i</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">zrq</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="RktValLink" pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">zr</span><span class="hspace">&nbsp;</span><span class="RktSym">zr</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">ziq</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="RktValLink" pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">zi</span><span class="hspace">&nbsp;</span><span class="RktSym">zi</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._cond))" class="RktStxLink" pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3e))" class="RktValLink" pltdoc="x">&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">zrq</span><span class="hspace">&nbsp;</span><span class="RktSym">ziq</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">4.0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="../reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))" class="RktStxLink" pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._add1))" class="RktValLink" pltdoc="x">add1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" class="RktValLink" pltdoc="x"><span class="nobreak">-</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym">zrq</span><span class="hspace">&nbsp;</span><span class="RktSym">ziq</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">cr</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="RktValLink" pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2.0</span><span class="hspace">&nbsp;</span><span class="RktSym">zr</span><span class="hspace">&nbsp;</span><span class="RktSym">zi</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">ci</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>The expressions <span class="RktPn">(</span><span class="RktSym">mandelbrot</span><span class="stt"> </span><span class="RktVal">10000000</span><span class="stt"> </span><span class="RktVal">62</span><span class="stt"> </span><span class="RktVal">500</span><span class="stt"> </span><span class="RktVal">1000</span><span class="RktPn">)</span> and
<span class="RktPn">(</span><span class="RktSym">mandelbrot</span><span class="stt"> </span><span class="RktVal">10000000</span><span class="stt"> </span><span class="RktVal">62</span><span class="stt"> </span><span class="RktVal">501</span><span class="stt"> </span><span class="RktVal">1000</span><span class="RktPn">)</span> each take a while to
produce an answer. Computing them both, of course, takes twice as
long:</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="RktValLink" pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mandelbrot</span><span class="hspace">&nbsp;</span><span class="RktVal">10000000</span><span class="hspace">&nbsp;</span><span class="RktVal">62</span><span class="hspace">&nbsp;</span><span class="RktVal">500</span><span class="hspace">&nbsp;</span><span class="RktVal">1000</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mandelbrot</span><span class="hspace">&nbsp;</span><span class="RktVal">10000000</span><span class="hspace">&nbsp;</span><span class="RktVal">62</span><span class="hspace">&nbsp;</span><span class="RktVal">501</span><span class="hspace">&nbsp;</span><span class="RktVal">1000</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>Unfortunately, attempting to run the two computations in parallel with
<span class="RktSym"><a href="../reference/futures.html#(def._((lib._racket/future..rkt)._future))" class="RktValLink" pltdoc="x">future</a></span> does not improve performance:</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">f</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/futures.html#(def._((lib._racket/future..rkt)._future))" class="RktValLink" pltdoc="x">future</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="RktStxLink" pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mandelbrot</span><span class="hspace">&nbsp;</span><span class="RktVal">10000000</span><span class="hspace">&nbsp;</span><span class="RktVal">62</span><span class="hspace">&nbsp;</span><span class="RktVal">501</span><span class="hspace">&nbsp;</span><span class="RktVal">1000</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="RktValLink" pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mandelbrot</span><span class="hspace">&nbsp;</span><span class="RktVal">10000000</span><span class="hspace">&nbsp;</span><span class="RktVal">62</span><span class="hspace">&nbsp;</span><span class="RktVal">500</span><span class="hspace">&nbsp;</span><span class="RktVal">1000</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/futures.html#(def._((lib._racket/future..rkt)._touch))" class="RktValLink" pltdoc="x">touch</a></span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>One problem is that the <span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="RktValLink" pltdoc="x">*</a></span> and <span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._/))" class="RktValLink" pltdoc="x">/</a></span> operations in the
first two lines of <span class="RktSym">mandelbrot</span> involve a mixture of exact and
inexact real numbers. Such mixtures typically trigger a slow path in
execution, and the general slow path is not safe for
parallelism. Consequently, the future created in this example is
almost immediately suspended, and it cannot resume until
<span class="RktSym"><a href="../reference/futures.html#(def._((lib._racket/future..rkt)._touch))" class="RktValLink" pltdoc="x">touch</a></span> is called.</p><p>Changing the first two lines of <span class="RktSym">mandelbrot</span> addresses that
first the problem:</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mandelbrot</span><span class="hspace">&nbsp;</span><span class="RktSym">iterations</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">ci</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" class="RktValLink" pltdoc="x"><span class="nobreak">-</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._/))" class="RktValLink" pltdoc="x">/</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="RktValLink" pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2.0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/flonums.html#(def._((lib._racket/flonum..rkt)._-~3efl))" class="RktValLink" pltdoc="x"><span class="nobreak">-&gt;</span>fl</a></span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/flonums.html#(def._((lib._racket/flonum..rkt)._-~3efl))" class="RktValLink" pltdoc="x"><span class="nobreak">-&gt;</span>fl</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1.0</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">cr</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" class="RktValLink" pltdoc="x"><span class="nobreak">-</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._/))" class="RktValLink" pltdoc="x">/</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="RktValLink" pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2.0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/flonums.html#(def._((lib._racket/flonum..rkt)._-~3efl))" class="RktValLink" pltdoc="x"><span class="nobreak">-&gt;</span>fl</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/flonums.html#(def._((lib._racket/flonum..rkt)._-~3efl))" class="RktValLink" pltdoc="x"><span class="nobreak">-&gt;</span>fl</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1.5</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">....</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>With that change, <span class="RktSym">mandelbrot</span> computations can run in
parallel. Nevertheless, performance still does not improve. The
problem is that most every arithmetic operation in this example
produces an inexact number whose storage must be allocated. Especially
frequent allocation triggers communication between parallel tasks that
defeats any performance improvement.</p><p>By using <a href="#(tech._flonum)" class="techoutside" pltdoc="x"><span class="techinside">flonum</span></a>-specific operations (see
<a href="#(part._fixnums+flonums)" pltdoc="x">Fixnum and Flonum Optimizations</a>), we can re-write <span class="RktSym">mandelbot</span> to use
much less allocation:</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mandelbrot</span><span class="hspace">&nbsp;</span><span class="RktSym">iterations</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">ci</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/flonums.html#(def._((lib._racket/flonum..rkt)._fl-))" class="RktValLink" pltdoc="x">fl-</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/flonums.html#(def._((lib._racket/flonum..rkt)._fl/))" class="RktValLink" pltdoc="x">fl/</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="RktValLink" pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2.0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/flonums.html#(def._((lib._racket/flonum..rkt)._-~3efl))" class="RktValLink" pltdoc="x"><span class="nobreak">-&gt;</span>fl</a></span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/flonums.html#(def._((lib._racket/flonum..rkt)._-~3efl))" class="RktValLink" pltdoc="x"><span class="nobreak">-&gt;</span>fl</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1.0</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">cr</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/flonums.html#(def._((lib._racket/flonum..rkt)._fl-))" class="RktValLink" pltdoc="x">fl-</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/flonums.html#(def._((lib._racket/flonum..rkt)._fl/))" class="RktValLink" pltdoc="x">fl/</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="RktValLink" pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2.0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/flonums.html#(def._((lib._racket/flonum..rkt)._-~3efl))" class="RktValLink" pltdoc="x"><span class="nobreak">-&gt;</span>fl</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/flonums.html#(def._((lib._racket/flonum..rkt)._-~3efl))" class="RktValLink" pltdoc="x"><span class="nobreak">-&gt;</span>fl</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1.5</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">zr</span><span class="hspace">&nbsp;</span><span class="RktVal">0.0</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">zi</span><span class="hspace">&nbsp;</span><span class="RktVal">0.0</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/if.html#(form._((quote._~23~25kernel)._if))" class="RktStxLink" pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3e))" class="RktValLink" pltdoc="x">&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktSym">iterations</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">i</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">zrq</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/flonums.html#(def._((lib._racket/flonum..rkt)._fl*))" class="RktValLink" pltdoc="x">fl*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">zr</span><span class="hspace">&nbsp;</span><span class="RktSym">zr</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">ziq</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/flonums.html#(def._((lib._racket/flonum..rkt)._fl*))" class="RktValLink" pltdoc="x">fl*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">zi</span><span class="hspace">&nbsp;</span><span class="RktSym">zi</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._cond))" class="RktStxLink" pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/flonums.html#(def._((lib._racket/flonum..rkt)._fl~3e))" class="RktValLink" pltdoc="x">fl&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/flonums.html#(def._((lib._racket/flonum..rkt)._fl+))" class="RktValLink" pltdoc="x">fl+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">zrq</span><span class="hspace">&nbsp;</span><span class="RktSym">ziq</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">4.0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="../reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))" class="RktStxLink" pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._add1))" class="RktValLink" pltdoc="x">add1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/flonums.html#(def._((lib._racket/flonum..rkt)._fl+))" class="RktValLink" pltdoc="x">fl+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/flonums.html#(def._((lib._racket/flonum..rkt)._fl-))" class="RktValLink" pltdoc="x">fl-</a></span><span class="hspace">&nbsp;</span><span class="RktSym">zrq</span><span class="hspace">&nbsp;</span><span class="RktSym">ziq</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">cr</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/flonums.html#(def._((lib._racket/flonum..rkt)._fl+))" class="RktValLink" pltdoc="x">fl+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/flonums.html#(def._((lib._racket/flonum..rkt)._fl*))" class="RktValLink" pltdoc="x">fl*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2.0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/flonums.html#(def._((lib._racket/flonum..rkt)._fl*))" class="RktValLink" pltdoc="x">fl*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">zr</span><span class="hspace">&nbsp;</span><span class="RktSym">zi</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">ci</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>This conversion can speed <span class="RktSym">mandelbrot</span> by a factor of 8, even
in sequential mode, but avoiding allocation also allows
<span class="RktSym">mandelbrot</span> to run usefully faster in parallel.</p><p>As a general guideline, any operation that is inlined by the
<a href="#(tech._jit)" class="techoutside" pltdoc="x"><span class="techinside">JIT</span></a> compiler runs safely in parallel, while other operations
that are not inlined (including all operations if the JIT compiler is
disabled) are considered unsafe. The <span class="stt">mzc</span> decompiler tool
annotates operations that can be inlined by the compiler (see
<a href="../raco/decompile.html" pltdoc="x"><span class="stt">raco decompile</span>: Decompiling Bytecode</a>), so the
decompiler can be used to help predict parallel performance.</p><p>To more directly report what is happening in a program that uses
<span class="RktSym"><a href="../reference/futures.html#(def._((lib._racket/future..rkt)._future))" class="RktValLink" pltdoc="x">future</a></span> and <span class="RktSym"><a href="../reference/futures.html#(def._((lib._racket/future..rkt)._touch))" class="RktValLink" pltdoc="x">touch</a></span>, operations are logged when they
suspend a computation or synchronize with the main computation.  For
example, running the original <span class="RktSym">mandelbrot</span> in a future produces
the following output in the <span class="RktVal">'</span><span class="RktVal">debug</span> log level:</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>To see <span class="RktVal">'</span><span class="RktVal">debug</span> logging output on stderr, set the
<span class="stt">PLTSTDERR</span> environment variable to <span class="stt">debug</span> or start
<span class="stt">racket</span> with <span class="nobreak"><span class="stt">-W</span></span> <span class="stt">debug</span>.</p></blockquote></blockquote></blockquote><p><table cellspacing="0"><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">future 1, process 1: BLOCKING on process 0; time: ....</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">....</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">future 1, process 0: HANDLING: *; time: ....</span></span></p></td></tr></table></p><p>The messages indicate which internal future-running task became
blocked on an unsafe operation, the time it blocked (in terms of
<span class="RktSym">current-inexact-miliseconds</span>), and the operation that caused
the computation it to block.</p><p>The first revision to <span class="RktSym">mandelbrot</span> avoids suspending at
<span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="RktValLink" pltdoc="x">*</a></span>, but produces many log entries of the form</p><p><table cellspacing="0"><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">future 1, process 0: synchronizing: [allocate memory]; time: ....</span></span></p></td></tr></table></p><p>The <span class="stt">[allocate memory]</span> part of the message indicates that
synchronization was needed for memory allocation.</p><h4>18.11<tt>&nbsp;</tt><a name="(part._effective-places)"></a>Parallelism with Places</h4><p>The <a href="../reference/places.html" class="RktModLink" pltdoc="x"><span class="RktSym">racket/place</span></a> library provides support for
performance improvement through parallelism with the <span class="RktSym"><a href="../reference/places.html#(form._((lib._racket/place..rkt)._place))" class="RktStxLink" pltdoc="x">place</a></span>
form. The <span class="RktSym"><a href="../reference/places.html#(form._((lib._racket/place..rkt)._place))" class="RktStxLink" pltdoc="x">place</a></span> form creates a <a name="(tech._place)"></a><span style="font-style: italic">place</span>, which is
effectively a new Racket instance that can run in parallel to other
places, including the initial place.  The full power of the Racket
language is available at each place, but places can communicate only
through message passing&#8212;<wbr></wbr>using the <span class="RktSym"><a href="../reference/places.html#(def._((lib._racket/place..rkt)._place-channel-put))" class="RktValLink" pltdoc="x">place-channel-put</a></span> and
<span class="RktSym"><a href="../reference/places.html#(def._((lib._racket/place..rkt)._place-channel-get))" class="RktValLink" pltdoc="x">place-channel-get</a></span> functions on a limited set of
values&#8212;<wbr></wbr>which helps ensure the safety and independence of parallel
computations.</p><p>As a starting example, the racket program below uses a <a href="#(tech._place)" class="techoutside" pltdoc="x"><span class="techinside">place</span></a> to
determine whether any number in the list has a double that is also in
the list:</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktMeta">#lang</span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="../reference/index.html" class="RktModLink" pltdoc="x"><span class="RktSym">racket</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="RktStxLink" pltdoc="x">provide</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">main</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">any-double?</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/for.html#(form._((lib._racket/private/base..rkt)._for/or))" class="RktStxLink" pltdoc="x">for/or</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">i</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/sequences.html#(def._((lib._racket/private/base..rkt)._in-list))" class="RktValLink" pltdoc="x">in-list</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/for.html#(form._((lib._racket/private/base..rkt)._for/or))" class="RktStxLink" pltdoc="x">for/or</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">i2</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/sequences.html#(def._((lib._racket/private/base..rkt)._in-list))" class="RktValLink" pltdoc="x">in-list</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3d))" class="RktValLink" pltdoc="x">=</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">i2</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="RktValLink" pltdoc="x">*</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">2</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">i</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">main</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">p</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/places.html#(form._((lib._racket/place..rkt)._place))" class="RktStxLink" pltdoc="x">place</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">ch</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">l</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/places.html#(def._((lib._racket/place..rkt)._place-channel-get))" class="RktValLink" pltdoc="x">place-channel-get</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">ch</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">l-double?</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">any-double?</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/places.html#(def._((lib._racket/place..rkt)._place-channel-put))" class="RktValLink" pltdoc="x">place-channel-put</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">ch</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">l-double?</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/places.html#(def._((lib._racket/place..rkt)._place-channel-put))" class="RktValLink" pltdoc="x">place-channel-put</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">p</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="RktValLink" pltdoc="x">list</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">1</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">2</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">4</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">8</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/places.html#(def._((lib._racket/place..rkt)._place-channel-get))" class="RktValLink" pltdoc="x">place-channel-get</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">p</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>The identifier <span class="RktSym">ch</span> after <span class="RktSym"><a href="../reference/places.html#(form._((lib._racket/place..rkt)._place))" class="RktStxLink" pltdoc="x">place</a></span> is bound to a <a name="(tech._place._channel)"></a><span style="font-style: italic">place
channel</span>. The remaining body expressions within the <span class="RktSym"><a href="../reference/places.html#(form._((lib._racket/place..rkt)._place))" class="RktStxLink" pltdoc="x">place</a></span> form
are evaluated in a new place, and the body expressions use <span class="RktSym">ch</span>
to communicate with the place that spawned the new place.</p><p>In the body of the <span class="RktSym"><a href="../reference/places.html#(form._((lib._racket/place..rkt)._place))" class="RktStxLink" pltdoc="x">place</a></span> form above, the new place receives a
list of numbers over <span class="RktSym">ch</span> and binds the list to <span class="RktSym">l</span>.  It
then calls <span class="RktSym">any-double?</span> on the list and binds the result to
<span class="RktSym">l-double?</span>. The final body expression sends the
<span class="RktSym">l-double?</span> result back to the original place over <span class="RktSym">ch</span>.</p><p>In DrRacket, after saving and running the above program, evaluate
<span class="RktPn">(</span><span class="RktSym">main</span><span class="RktPn">)</span> in the interactions window to create the new
place. <span class="refelem"><span class="refcolumn"><span class="refcontent">When using <a href="#(tech._place)" class="techoutside" pltdoc="x"><span class="techinside">places</span></a> inside DrRacket, the
module containg place code must be saved to a file before it will
execute.</span></span></span>  Alternatively, save the program as <span class="stt">"double.rkt"</span>
and run from a command line with</p><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">racket -tm double.rkt</span></p><p>where the <span class="nobreak"><span class="stt">-t</span></span> flag tells <span class="stt">racket</span> to load the
<span class="stt">double.rkt</span> module, the <span class="nobreak"><span class="stt">-m</span></span> flag calls the exported
<span class="RktSym">main</span> function, and <span class="nobreak"><span class="stt">-tm</span></span> combines the two flags.</p><p>The <span class="RktSym"><a href="../reference/places.html#(form._((lib._racket/place..rkt)._place))" class="RktStxLink" pltdoc="x">place</a></span> form has two subtle features. First, it lifts the
<span class="RktSym"><a href="../reference/places.html#(form._((lib._racket/place..rkt)._place))" class="RktStxLink" pltdoc="x">place</a></span> body to an anonymous, module-level function.  This
lifting means that any binding referenced by the <span class="RktSym"><a href="../reference/places.html#(form._((lib._racket/place..rkt)._place))" class="RktStxLink" pltdoc="x">place</a></span> body
must be available in the module&rsquo;s top level. Second, the
<span class="RktSym"><a href="../reference/places.html#(form._((lib._racket/place..rkt)._place))" class="RktStxLink" pltdoc="x">place</a></span> form <span class="RktSym"><a href="../reference/Module_Names_and_Loading.html#(def._((quote._~23~25kernel)._dynamic-require))" class="RktValLink" pltdoc="x">dynamic-require</a></span>s the enclosing module in
a newly created place. As part of the <span class="RktSym"><a href="../reference/Module_Names_and_Loading.html#(def._((quote._~23~25kernel)._dynamic-require))" class="RktValLink" pltdoc="x">dynamic-require</a></span>, the
current module body is evaluated in the new place.  The consequence of
this second feature is that <span class="RktSym"><a href="../reference/places.html#(form._((lib._racket/place..rkt)._place))" class="RktStxLink" pltdoc="x">place</a></span> should not appear immediately
in a module or in a function that is called in a module&rsquo;s top level;
otherwise, invoking the module will invoke the same module in a new
place, and so on, triggering a cascade of place creations that will
soon exhaust memory.</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktMeta">#lang</span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="../reference/index.html" class="RktModLink" pltdoc="x"><span class="RktSym">racket</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="RktStxLink" pltdoc="x">provide</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">main</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Don't</span><span class="hspace">&nbsp;</span><span class="RktCmt">do</span><span class="hspace">&nbsp;</span><span class="RktCmt">this!</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">p</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/places.html#(form._((lib._racket/place..rkt)._place))" class="RktStxLink" pltdoc="x">place</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">ch</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/places.html#(def._((lib._racket/place..rkt)._place-channel-get))" class="RktValLink" pltdoc="x">place-channel-get</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">ch</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">indirect-place-invocation</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">p2</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/places.html#(form._((lib._racket/place..rkt)._place))" class="RktStxLink" pltdoc="x">place</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">ch</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/places.html#(def._((lib._racket/place..rkt)._place-channel-get))" class="RktValLink" pltdoc="x">place-channel-get</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">ch</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Don't</span><span class="hspace">&nbsp;</span><span class="RktCmt">do</span><span class="hspace">&nbsp;</span><span class="RktCmt">this,</span><span class="hspace">&nbsp;</span><span class="RktCmt">either!</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">indirect-place-invocation</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.2.1&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.2.1&quot;);">top</a></span><span class="navright"><a href="module-runtime-config.html" title="backward to &quot;17.3.6 Module-Handling Configuration&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;The Racket Guide&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<a href="running.html" title="forward to &quot;19 Running and Creating Executables&quot;" pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>